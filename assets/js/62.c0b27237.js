(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{161:function(t,a,e){"use strict";e.r(a);var s=e(0),v=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"快速开始"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#快速开始"}},[t._v("#")]),t._v(" 快速开始")]),t._v(" "),e("p",[t._v("单点登录（Single Sign On），简称为 SSO，是目前比较流行的企业业务整合的解决方案之一。SSO 的定义是在多个应用系统中，用户只需要登录一次就可以访问所有相互信任的应用系统。")]),t._v(" "),e("h2",{attrs:{id:"installation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#installation"}},[t._v("#")]),t._v(" Installation")]),t._v(" "),e("h3",{attrs:{id:"生产环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#生产环境"}},[t._v("#")]),t._v(" 生产环境")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run start\n")])])]),e("h3",{attrs:{id:"开发环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开发环境"}},[t._v("#")]),t._v(" 开发环境")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run:node\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run:vue\n")])])]),e("p",[t._v("启动后将在 "),e("a",{attrs:{href:"http://localhost:3000",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://localhost:3000"),e("OutboundLink")],1),t._v(" 启动 node 服务，在 "),e("a",{attrs:{href:"http://localhost:3002",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://localhost:3002"),e("OutboundLink")],1),t._v(" 启动 vue 服务")]),t._v(" "),e("p",[t._v("其中 node 服务的静态资源依赖于打包后的 vue 项目。")]),t._v(" "),e("p",[e("em",[t._v("可单独启动 node 服务而不启动 vue 项目")])]),t._v(" "),e("h2",{attrs:{id:"项目结构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#项目结构"}},[t._v("#")]),t._v(" 项目结构")]),t._v(" "),e("h3",{attrs:{id:"源码目录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#源码目录"}},[t._v("#")]),t._v(" 源码目录")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("+-- build 构建相关\n+-- controller 控制器\n+-- dist 静态资源\n+-- helper 帮助类\n+-- src 前端源码\n|   +-- components vue组件\n|   |   +-- Admin.vue 主框架\n|   |   +-- Application.vue 应用页面\n|   |   +-- Doc.vue 说明页面\n|   |   +-- Login.vue 登录页面\n|   |   +-- User.vue 用户页面\n|   +-- axios.config.js 请求拦截器配置\n|   +-- main.js 入口文件\n+-- app.js 启动文件\n+-- index.html 模板文件\n")])])]),e("h3",{attrs:{id:"核心技术"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#核心技术"}},[t._v("#")]),t._v(" 核心技术")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("nodejs")])]),t._v(" "),e("li",[e("p",[t._v("vue")])]),t._v(" "),e("li",[e("p",[t._v("jsonwebtoken")])])]),t._v(" "),e("h2",{attrs:{id:"单点登录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#单点登录"}},[t._v("#")]),t._v(" 单点登录")]),t._v(" "),e("h3",{attrs:{id:"注册应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#注册应用"}},[t._v("#")]),t._v(" 注册应用")]),t._v(" "),e("p",[t._v("在使用前首先在单点系统上注册应用，注册成功后会得到 "),e("code",[t._v("appid")]),t._v(" 和 "),e("code",[t._v("appsecret")]),t._v(" ，将来需要用这两个参数做身份认证。")]),t._v(" "),e("h3",{attrs:{id:"页面跳转"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#页面跳转"}},[t._v("#")]),t._v(" 页面跳转")]),t._v(" "),e("p",[t._v("创建应用后，在需要登录的时候跳转到单点系统的授权页面，如 "),e("code",[t._v("http://localhost:3000/api/oauth/${appid}/${callback_url}")]),t._v(" 。")]),t._v(" "),e("p",[t._v("跳转时需要携带下面的参数")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("参数")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("说明")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("appid")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("应用标识, 在应用类别中可查看")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("callback_url")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("回调地址，经过 UrlEncode 编码后能正确访问的 url 地址")])])])]),t._v(" "),e("p",[e("code",[t._v("eg:")])]),t._v(" "),e("p",[t._v("应用标识为： "),e("code",[t._v("1566383195899")]),t._v(" 、回调地址为： "),e("code",[t._v("https://www.baidu.com")]),t._v(" , 此时正确的跳转地址如下")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("http://localhost:3000/oauth/1566383195899/https%3a%2f%2fwww.baidu.com\n")])])]),e("h3",{attrs:{id:"登录回调"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#登录回调"}},[t._v("#")]),t._v(" 登录回调")]),t._v(" "),e("p",[t._v("在单点系统成功登录后，会按照传入的 "),e("code",[t._v("callback_url")]),t._v(" 进行重定向，回调时会自动带上 "),e("code",[t._v("key")]),t._v(" 信息，如")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("https://www.baidu.com?key=eyJpdiI6Ik1sSUJaK3RcL3FCVzVcLzl1\n")])])]),e("p",[t._v("此时页面带参跳转回应用的回调页面。")]),t._v(" "),e("ul",[e("li",[t._v("如果是已登录状态时，其他子应用进入会瞬间完成回调授权，不会看到登录页面")])]),t._v(" "),e("p",[e("em",[t._v("PS：key 的有效期为 5 分钟")])]),t._v(" "),e("h2",{attrs:{id:"key-转-token"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#key-转-token"}},[t._v("#")]),t._v(" key 转 token")]),t._v(" "),e("p",[t._v("在应用中获取用户信息前必须通过 "),e("code",[t._v("/api/key2token")]),t._v(" 接口形式从单点系统获取相关 token，需要传入以下参数")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("参数")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("说明")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("appid")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("应用标识")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("appsecret")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("应用私钥")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("key")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("授权回调后的参数")])])])]),t._v(" "),e("p",[t._v("接口要求如下：")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("请求方式为 "),e("code",[t._v("post")])])]),t._v(" "),e("li",[e("p",[t._v("数据格式为 "),e("code",[t._v("application/json")])])])]),t._v(" "),e("p",[t._v("返回结果如例：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n\t"status": true,\n\t"data": \'eyJpdiI6Ik1sSUJaK3RcL3FCVzVcLzl1eyJpdiI6Ik1sSUJaK3RcL3FCVzVcLzl1eyJpdiI6Ik1sSUJaK3RcL3FCVzVcLzl1eyJpdiI6Ik1sSUJaK3RcL3FCVzVcLzl1eyJpdiI6Ik1sSUJaK3RcL3FCVzVcLzl1eyJpdiI6Ik1sSUJaK3RcL3FCVzVcLzl1eyJpdiI6Ik1sSUJaK3RcL3FCVzVcLzl1\',\n\t"msg": "",\n}\n')])])]),e("p",[t._v("其中 status 为 true 时代表接口正常, data 代表 token 信息，后续与 sso 的交互都需要携带")]),t._v(" "),e("p",[e("em",[t._v("key 一次有效，只能使用一次，且五分钟内有效")])]),t._v(" "),e("h2",{attrs:{id:"用户认证"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#用户认证"}},[t._v("#")]),t._v(" 用户认证")]),t._v(" "),e("p",[t._v("在应用中获取用户信息时必须通过 "),e("code",[t._v("/api/token2userinfo")]),t._v(" 接口形式从单点系统获取，需要传入以下参数")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("参数")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("说明")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("appid")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("应用标识")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("appsecret")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("应用私钥")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("token")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("通过 key 换取的 token")])])])]),t._v(" "),e("p",[t._v("接口要求如下：")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("请求方式为 "),e("code",[t._v("post")])])]),t._v(" "),e("li",[e("p",[t._v("数据格式为 "),e("code",[t._v("application/json")])])])]),t._v(" "),e("p",[t._v("返回结果如例：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n\t"status": true,\n\t"data": {\n\t\t"id": "admin",\n\t\t"name": "管理员",\n\t\t"avatar": "https://c-ssl.duitang.com/uploads/item/201712/22/20171222223729_d8HCB.jpeg"\n\t},\n\t"msg": "",\n}\n')])])]),e("p",[t._v("其中 status 为 true 时代表接口正常")]),t._v(" "),e("p",[e("em",[t._v("token 60 分钟内有效")])]),t._v(" "),e("h2",{attrs:{id:"单点注销"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#单点注销"}},[t._v("#")]),t._v(" 单点注销")]),t._v(" "),e("p",[t._v("单点登录自然也会有单点注销，在一个子系统中注销，所有子系统的会话都将被销毁。")]),t._v(" "),e("p",[t._v("下面是具体的应用场景，包括登录和注销，可按实际场景选择。")]),t._v(" "),e("p",[t._v("建议使用 "),e("code",[t._v("NODE-SSO-CONNECT")]),t._v(" 模块，一键适配全部场景。")]),t._v(" "),e("h2",{attrs:{id:"域名说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#域名说明"}},[t._v("#")]),t._v(" 域名说明")]),t._v(" "),e("p",[t._v("本机上配置多个域名地址，其中 "),e("code",[t._v("sso.test.com")]),t._v(" 用于做单点服务， "),e("code",[t._v("a/b/c/d")]),t._v(" 分别代表不同的子应用。")]),t._v(" "),e("p",[t._v("具体设置，[点我](http://localhost:3000/admin/doc/1. Host%E9%85%8D%E7%BD%AE.md)")]),t._v(" "),e("h2",{attrs:{id:"应用场景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#应用场景"}},[t._v("#")]),t._v(" 应用场景")]),t._v(" "),e("h3",{attrs:{id:"_1-同一顶级域名"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-同一顶级域名"}},[t._v("#")]),t._v(" 1 同一顶级域名")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("a.test.com 、b.test.com、sso.test.com\n")])])]),e("p",[t._v("描述：N 个系统，但是 "),e("code",[t._v("一级域名 是一致的")]),t._v(" 。如果不懂 一级域名 、 二级域名 是什么意思先查看这篇文章。"),e("a",{attrs:{href:"http://www.xinnet.com/xinnews/domain/34646.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("《二级域名是什么》"),e("OutboundLink")],1),t._v("。这个案例实现相对简单。")]),t._v(" "),e("p",[t._v("原理：其实质这里就是利用了 二级域名 写 一级域名 的 Cookie 。")]),t._v(" "),e("p",[t._v("优点：轻量级、可插拔、效率非常高。")]),t._v(" "),e("p",[t._v("缺点：局限性限于同一域名。")]),t._v(" "),e("h3",{attrs:{id:"_2-不同顶级域名"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-不同顶级域名"}},[t._v("#")]),t._v(" 2 不同顶级域名")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("a.test.com 、a.debug.com、a.dev.com\n")])])]),e("ul",[e("li",[t._v("a：通过 iframe")]),t._v(" "),e("li",[t._v("b：全部请求都过用户中心")])]),t._v(" "),e("h3",{attrs:{id:"_3-不限域名"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-不限域名"}},[t._v("#")]),t._v(" 3 不限域名")]),t._v(" "),e("ul",[e("li",[t._v("通过 sso 主动推送方式")])]),t._v(" "),e("h2",{attrs:{id:"使用node-sso-connect"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用node-sso-connect"}},[t._v("#")]),t._v(" 使用NODE-SSO-CONNECT")]),t._v(" "),e("p",[t._v("我们提供了配套的帮助模块，可快速实现 "),e("strong",[t._v("单点注销")]),t._v(" , 详细请看后续文档。")]),t._v(" "),e("h2",{attrs:{id:"注意事项"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[t._v("#")]),t._v(" 注意事项")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("妥善保管 appid 和 appsecret")])]),t._v(" "),e("li",[e("p",[t._v("token 有时间限制，建议自行维护登录态")])]),t._v(" "),e("li",[e("p",[t._v("callback_url 需要先进行 URL 编码")])])])])}),[],!1,null,null,null);a.default=v.exports}}]);