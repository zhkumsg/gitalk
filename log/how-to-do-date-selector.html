<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>手摸手系统：使用原生JS封装时间区间选择器插件 | Wiki文档中心</title>
    <meta name="description" content="描述">
    <link rel="icon" href="/logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.4d8ba4a7.css" as="style"><link rel="preload" href="/assets/js/app.3328e81d.js" as="script"><link rel="preload" href="/assets/js/2.c715c0f2.js" as="script"><link rel="preload" href="/assets/js/29.29379faf.js" as="script"><link rel="prefetch" href="/assets/js/10.abfcde09.js"><link rel="prefetch" href="/assets/js/11.3ee26f26.js"><link rel="prefetch" href="/assets/js/12.45406b92.js"><link rel="prefetch" href="/assets/js/13.7aa97305.js"><link rel="prefetch" href="/assets/js/14.34708031.js"><link rel="prefetch" href="/assets/js/15.76570f77.js"><link rel="prefetch" href="/assets/js/16.29d4e7cd.js"><link rel="prefetch" href="/assets/js/17.eda984dd.js"><link rel="prefetch" href="/assets/js/18.1bb9f9b9.js"><link rel="prefetch" href="/assets/js/19.231ae034.js"><link rel="prefetch" href="/assets/js/20.26a455ac.js"><link rel="prefetch" href="/assets/js/21.62f18186.js"><link rel="prefetch" href="/assets/js/22.177e8b0f.js"><link rel="prefetch" href="/assets/js/23.60274af5.js"><link rel="prefetch" href="/assets/js/24.0ea00a49.js"><link rel="prefetch" href="/assets/js/25.3d5be951.js"><link rel="prefetch" href="/assets/js/26.19229e66.js"><link rel="prefetch" href="/assets/js/27.6d99c0ab.js"><link rel="prefetch" href="/assets/js/28.d28de4e0.js"><link rel="prefetch" href="/assets/js/3.90a63800.js"><link rel="prefetch" href="/assets/js/30.9fe6691b.js"><link rel="prefetch" href="/assets/js/31.2c753b40.js"><link rel="prefetch" href="/assets/js/32.b87ed25b.js"><link rel="prefetch" href="/assets/js/33.69099052.js"><link rel="prefetch" href="/assets/js/34.fb2e76ab.js"><link rel="prefetch" href="/assets/js/35.41f3d46b.js"><link rel="prefetch" href="/assets/js/36.78adf827.js"><link rel="prefetch" href="/assets/js/37.6cb8f1dc.js"><link rel="prefetch" href="/assets/js/38.3296535c.js"><link rel="prefetch" href="/assets/js/39.852ec6ec.js"><link rel="prefetch" href="/assets/js/4.338175e6.js"><link rel="prefetch" href="/assets/js/40.4f030cd4.js"><link rel="prefetch" href="/assets/js/41.7b948635.js"><link rel="prefetch" href="/assets/js/42.7038bdd7.js"><link rel="prefetch" href="/assets/js/43.09ba85b3.js"><link rel="prefetch" href="/assets/js/44.30c43542.js"><link rel="prefetch" href="/assets/js/45.7fc52c71.js"><link rel="prefetch" href="/assets/js/46.e57513f1.js"><link rel="prefetch" href="/assets/js/47.79ad04e1.js"><link rel="prefetch" href="/assets/js/48.806e5af9.js"><link rel="prefetch" href="/assets/js/49.1e083288.js"><link rel="prefetch" href="/assets/js/5.15ce4230.js"><link rel="prefetch" href="/assets/js/50.eef1990e.js"><link rel="prefetch" href="/assets/js/51.cdde33a8.js"><link rel="prefetch" href="/assets/js/52.bcb09293.js"><link rel="prefetch" href="/assets/js/53.87c2baec.js"><link rel="prefetch" href="/assets/js/54.4d9707e7.js"><link rel="prefetch" href="/assets/js/55.5fb2a242.js"><link rel="prefetch" href="/assets/js/56.63b1cb46.js"><link rel="prefetch" href="/assets/js/57.4108fa62.js"><link rel="prefetch" href="/assets/js/58.38c656c4.js"><link rel="prefetch" href="/assets/js/59.2e9da043.js"><link rel="prefetch" href="/assets/js/6.4db8bcb4.js"><link rel="prefetch" href="/assets/js/60.62a9603a.js"><link rel="prefetch" href="/assets/js/61.70db4cce.js"><link rel="prefetch" href="/assets/js/62.c0b27237.js"><link rel="prefetch" href="/assets/js/63.a1ff59d9.js"><link rel="prefetch" href="/assets/js/64.ba32929f.js"><link rel="prefetch" href="/assets/js/65.504fa9a6.js"><link rel="prefetch" href="/assets/js/66.39a7e2d4.js"><link rel="prefetch" href="/assets/js/67.409ffc00.js"><link rel="prefetch" href="/assets/js/68.21b084fc.js"><link rel="prefetch" href="/assets/js/69.1d10efe9.js"><link rel="prefetch" href="/assets/js/7.6832275b.js"><link rel="prefetch" href="/assets/js/70.0391f331.js"><link rel="prefetch" href="/assets/js/71.af289666.js"><link rel="prefetch" href="/assets/js/72.9a8504b0.js"><link rel="prefetch" href="/assets/js/73.0d35f166.js"><link rel="prefetch" href="/assets/js/74.75cd3652.js"><link rel="prefetch" href="/assets/js/75.53679119.js"><link rel="prefetch" href="/assets/js/76.5ea9dd36.js"><link rel="prefetch" href="/assets/js/77.95fe4c15.js"><link rel="prefetch" href="/assets/js/78.aaff367b.js"><link rel="prefetch" href="/assets/js/8.3662cfcf.js"><link rel="prefetch" href="/assets/js/9.a40092b3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4d8ba4a7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Wiki文档中心" class="logo"> <span class="site-name can-hide">Wiki文档中心</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/introduce/" class="nav-link">指南</a></div><div class="nav-item"><a href="/sso/" class="nav-link">单点登录</a></div><div class="nav-item"><a href="/seo/" class="nav-link">服务端渲染</a></div><div class="nav-item"><a href="/linux/" class="nav-link">Linux基础</a></div><div class="nav-item"><a href="/http/" class="nav-link">解读Http</a></div><div class="nav-item"><a href="/microfrontend/" class="nav-link">微前端</a></div><div class="nav-item"><a href="/weixin/" class="nav-link">微信全家桶</a></div><div class="nav-item"><a href="/performance/" class="nav-link">性能优化</a></div><div class="nav-item"><a href="/log/" class="nav-link router-link-active">每日随笔</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/introduce/" class="nav-link">指南</a></div><div class="nav-item"><a href="/sso/" class="nav-link">单点登录</a></div><div class="nav-item"><a href="/seo/" class="nav-link">服务端渲染</a></div><div class="nav-item"><a href="/linux/" class="nav-link">Linux基础</a></div><div class="nav-item"><a href="/http/" class="nav-link">解读Http</a></div><div class="nav-item"><a href="/microfrontend/" class="nav-link">微前端</a></div><div class="nav-item"><a href="/weixin/" class="nav-link">微信全家桶</a></div><div class="nav-item"><a href="/performance/" class="nav-link">性能优化</a></div><div class="nav-item"><a href="/log/" class="nav-link router-link-active">每日随笔</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/log/" class="sidebar-link">随笔</a></li><li><a href="/log/how-to-use-prerender-spa-plugin.html" class="sidebar-link">prerender-spa-plugin预渲染进行seo优化</a></li><li><a href="/log/how-to-create-scroll-module.html" class="sidebar-link">vue项目封装并发布无限滚动指令优化渲染性能的npm模块</a></li><li><a href="/log/how-to-config-cdn-in-webpack.html" class="sidebar-link">webpack使用HtmlWebpackPlugin进行cdn配置</a></li><li><a href="/log/what-does-life-cycle-mean.html" class="sidebar-link">对于“钩子函数”的理解</a></li><li><a href="/log/how-to-append-router-in-extdotnet.html" class="sidebar-link">给EXT. NET管理系统添加路由</a></li><li><a href="/log/what-about-insert-vue-into-extdotnet.html" class="sidebar-link">关于在EXT.NET页面中嵌入vue的弊端与应对方法</a></li><li><a href="/log/using-python-to-simulate-browser-behavior.html" class="sidebar-link">关于python模拟浏览器行为</a></li><li><a href="/log/how-to-quick-in-cmd.html" class="sidebar-link">快速进入此目录的命令窗口</a></li><li><a href="/log/how-to-use-nodejs-build-mini-project-1.html" class="sidebar-link">手把手，教你用nodejs搭建后台最小系统（大量图文）系列一</a></li><li><a href="/log/how-to-use-nodejs-build-mini-project-2.html" class="sidebar-link">手把手，教你用nodejs搭建后台最小系统（大量图文）系列二</a></li><li><a href="/log/how-to-use-vue-in-vs2010.html" class="sidebar-link">在VS2010下利用vue开发团队项目</a></li><li><a href="/log/what-is-vue-css-scoped.html" class="sidebar-link">Vue下是如何实现CSS私有作用域的</a></li><li><a href="/log/webpack-base-use.html" class="sidebar-link">webpack的基本使用</a></li><li><a href="/log/how-to-do-out-side-click.html" class="sidebar-link">如何实现out-side-click功能</a></li><li><a href="/log/how-to-do-date-selector.html" class="active sidebar-link">手摸手系统：使用原生JS封装时间区间选择器插件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/log/how-to-access-buried-point-quickly-under-vue.html" class="sidebar-link">在vue下如何快速接入埋点</a></li><li><a href="/log/how-to-engineer-front-end-projects.html" class="sidebar-link">如何工程化前端项目</a></li><li><a href="/log/engineering-project.html" class="sidebar-link">工程化项目</a></li><li><a href="/log/vpn.html" class="sidebar-link">Ubuntu 安装OpenVPN客户端GUI</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="手摸手系统：使用原生js封装时间区间选择器插件"><a href="#手摸手系统：使用原生js封装时间区间选择器插件" class="header-anchor">#</a> 手摸手系统：使用原生JS封装时间区间选择器插件</h1> <p>网上已经有了各种各样的插件，满地的轮子，为什么我们还要自己封装呢？其实道理也很简单，因为不这些插件不是定制的，灵活性和可拓展性自然有所缺陷。就在前几天，产品和设计围过来说希望开发一个时间选择组件，看刚好上一次迭代已经结束了，就试着开发一下。</p> <p><img src="https://upload-images.jianshu.io/upload_images/13908708-a9c50d83f225b4ed.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="效果图"></p> <p>最开始打算用vue来封装的，但是项目采用的是amazeui和JQuery，无法直接使用vue，所以又想着封装一个JQuery插件。但是想想还是不合适，为什么不用原生javascript来做呢，这样不管什么框架都能兼容。</p> <p>在开始前需要说明的是，本插件使用es6开发，通过 <code>babel</code> 和 <code>uglifyjs</code> 编译压缩成生产代码，会涉及到部分的 <code>nodejs</code> 代码和 <code>javascript</code> 原型相关的代码。</p> <p><a href="http://zhkumsg.gitee.io/date-selector/" target="_blank" rel="noopener noreferrer">在线 demo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
git项目：https://gitee.com/zhkumsg/date-selector</p> <h3 id="项目初始化"><a href="#项目初始化" class="header-anchor">#</a> 项目初始化</h3> <p>开发插件，创建个js文件就可以解决了，不过考虑到代码更新和推送到npmjs上，还是初始化一个完整的项目比较合适。
首先我们创建一个文件夹 <code>date-selector</code> ，然后用npm初始化</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">mkdir</span> date-selector
$ <span class="token builtin class-name">cd</span> date-selector
$ <span class="token function">npm</span> init
</code></pre></div><p>紧接着我们新建几个文件，分别是index.html，src/index.js，lib/index.css，如下</p> <div class="language- extra-class"><pre class="language-text"><code>+-- lib
|   +-- index.css    # 插件样式文件
+-- src
|    +-- index.js      # 插件原es6文件
+-- index.html       # 首页
+-- package.json   # 项目文件
</code></pre></div><p>其中 <code>lib</code> 放css文件和打包后的js文件， <code>src</code> 放未经编译的es6代码， <code>index.html</code> 为html页面，用于实例化插件。</p> <h3 id="静态页面开发"><a href="#静态页面开发" class="header-anchor">#</a> 静态页面开发</h3> <p>文件和目录已经准备好了，我们先在index.html上引入css和js代码，并加上相关内容。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>./lib/index.css<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>box<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>我是一个输入框<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>./src/index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>然后我推荐使用一个npm模块， <code>anywhere</code> 来启动项目，它可以把任意目录当做一个web服务器来使用</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># date-selector根目录</span>
$ anywhere -v
</code></pre></div><p>启动后它会自动在浏览器中打开，当然也可使用其他方式浏览该页面。</p> <hr> <p>当可以正常浏览页面后，我们先在index.html上把静态布局开发出来，开发不会涉及任何的逻辑，只是用css和标签构造出合适的效果。
看效果图可以看出，该插件的ui有两大部分组成，左边是日历部分，右边是结果部分。<img src="https://upload-images.jianshu.io/upload_images/13908708-4772530c244f20e0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>由于只是普通的布局，真正布局会在js中动态渲染，所以这里先略过介绍。</p> <h3 id="插件骨架封装"><a href="#插件骨架封装" class="header-anchor">#</a> 插件骨架封装</h3> <p>了解布局方式后，我们开始 <code>index.js</code> 的封装。本插件将通过实例化一个方法，自动在指定元素上显示插件内容，骨架代码如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/index.js</span>
<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">DateSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token class-name">DateSelector</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 导出供外部访问</span>
    window<span class="token punctuation">.</span>DateSelector <span class="token operator">=</span> DateSelector<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>为了避免污染全局变量，这里使用了匿名函数，只对外暴露 <code>DateSelector</code> 方法。</p> <p>为了更多的自定义配置，我们继续在 <code>DateSelector</code> 方法上接受参数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">DateSelector</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
    target<span class="token punctuation">,</span>
    data
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span> <span class="token comment">// 目标dom</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 新建dom</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="渲染代码封装"><a href="#渲染代码封装" class="header-anchor">#</a> 渲染代码封装</h3> <p>接受并保存参数后，我们要开始构造插件的内容了，也就是动态渲染html。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 渲染日历头部代码</span>
<span class="token function">renderTop</span><span class="token punctuation">(</span><span class="token parameter">date</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &lt;div class=&quot;top&quot;&gt;
        &lt;span class=&quot;goto-btn prev-year&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;
        &lt;span class=&quot;goto-btn prev-month&quot;&gt;&amp;lt;&lt;/span&gt;
        &lt;span class=&quot;goto-date&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>date<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">年</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">月&lt;/span&gt;
        &lt;span class=&quot;goto-btn next-month&quot;&gt;&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;goto-btn next-year&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;
    &lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 渲染日历星期1-7代码</span>
<span class="token function">renderWeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div class=&quot;week&quot;&gt;&lt;span&gt;日&lt;/span&gt;&lt;span&gt;一&lt;/span&gt;&lt;span&gt;二&lt;/span&gt;&lt;span&gt;三&lt;/span&gt;&lt;span&gt;四&lt;/span&gt;&lt;span&gt;五&lt;/span&gt;&lt;span&gt;六&lt;/span&gt;&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>紧接着就是渲染日期，这也是比较复杂的部分，主要思路是动态算出当前页有多少行、当前月第一天起始位置，循环生成字符串。而且这里会设计到样式显示问题，所以还需要根据选中结果动态设置class</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">renderDays</span><span class="token punctuation">(</span><span class="token parameter">date</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> rows <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMonthStart</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMonthCount</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> year <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> month <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> firstTime <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>selections<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">?</span>
        <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>selections<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span>
        Number<span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> lastTime <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>selections<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">?</span>
        <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>selections<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span>
        Number<span class="token punctuation">.</span><span class="token constant">MIN_VALUE</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token punctuation">(</span>count <span class="token operator">+</span> start<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        rows<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'&lt;div class=&quot;day-row&quot;&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> day <span class="token operator">=</span> i <span class="token operator">*</span> <span class="token number">7</span> <span class="token operator">+</span> j <span class="token operator">-</span> start <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> datadate <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> cls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'day-item'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> nonull <span class="token operator">=</span> day <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> day <span class="token operator">&lt;=</span> count<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>nonull<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                datadate <span class="token operator">=</span> year <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> month <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> day<span class="token punctuation">;</span>
                <span class="token keyword">const</span> currentTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>datadate<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>selections<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>datadate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    cls<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'highlight'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>currentTime <span class="token operator">&gt;</span> firstTime <span class="token operator">&amp;&amp;</span> currentTime <span class="token operator">&lt;</span> lastTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    cls<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'selected'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_disabledDate <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_disabledDate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>datadate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        cls<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'notallow'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                cls<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'null'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            rows<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;span data-date=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>datadate<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; class=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cls<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>nonull <span class="token operator">?</span> day <span class="token operator">:</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/span&gt;</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        rows<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'&lt;/div&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> rows<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>到这里核心的渲染就已经完成了，后续的是如何把各个渲染串起来。</p> <h3 id="交互逻辑封装"><a href="#交互逻辑封装" class="header-anchor">#</a> 交互逻辑封装</h3> <p>完成渲染后，我们再绑定事件，主要有上/下一年点击、上/下一月点击、日期点击、选中时间结果点击、添加时间区间点击、删除时间区间点击、遮罩点击、滚动监听。</p> <p>比较有意思的是如何寻找目标元素位置和不添加遮罩层，通过坐位位置判断是否点击后隐藏插件功能的实现。</p> <h3 id="插件构建使用"><a href="#插件构建使用" class="header-anchor">#</a> 插件构建使用</h3> <p>最后通过babel和uglify-js构建代码</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ babel ./src --presets babel-preset-es2015 --out-dir ./lib
$ uglifyjs lib/index.js -o lib/index.min.js
</code></pre></div><h3 id="使用方式"><a href="#使用方式" class="header-anchor">#</a> 使用方式</h3> <p><code>引入资源</code></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>box<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>引入 css 文件</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://zhkumsg.gitee.io/date-selector/lib/index.css<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>引入 js 文件</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://zhkumsg.gitee.io/date-selector/lib/index.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>实例化插件</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> selector <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DateSelector</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    target<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#box'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    max<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    auto<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><hr> <h3 id="属性介绍"><a href="#属性介绍" class="header-anchor">#</a> 属性介绍</h3> <table><thead><tr><th style="text-align:center;">属性</th> <th style="text-align:center;">类型</th> <th style="text-align:center;">必填</th> <th style="text-align:center;">作用</th></tr></thead> <tbody><tr><td style="text-align:center;">target</td> <td style="text-align:center;">dom</td> <td style="text-align:center;">必填</td> <td style="text-align:center;">目标元素，将在这下面显示</td></tr> <tr><td style="text-align:center;">data</td> <td style="text-align:center;">Array</td> <td style="text-align:center;">选填</td> <td style="text-align:center;">为二元数组，内层数组为选中结果</td></tr> <tr><td style="text-align:center;">max</td> <td style="text-align:center;">Number</td> <td style="text-align:center;">选填</td> <td style="text-align:center;">默认为 1，表示最多选中一组</td></tr> <tr><td style="text-align:center;">auto</td> <td style="text-align:center;">Bool</td> <td style="text-align:center;">选填</td> <td style="text-align:center;">默认为 false, 代表自动显示</td></tr> <tr><td style="text-align:center;">className</td> <td style="text-align:center;">String</td> <td style="text-align:center;">选填</td> <td style="text-align:center;">自定义类名</td></tr> <tr><td style="text-align:center;">change</td> <td style="text-align:center;">Function</td> <td style="text-align:center;">选填</td> <td style="text-align:center;">修改后触发</td></tr> <tr><td style="text-align:center;">confirm</td> <td style="text-align:center;">Function</td> <td style="text-align:center;">选填</td> <td style="text-align:center;">确认后触发</td></tr> <tr><td style="text-align:center;">disabledDate</td> <td style="text-align:center;">Function</td> <td style="text-align:center;">选填</td> <td style="text-align:center;">设置禁用状态，参数为当前日期，要求返回 Boolean</td></tr></tbody></table> <p><code>selector.show()</code> 显示弹窗</p> <p><code>selector.hide()</code> 关闭弹窗</p> <p><code>selector.toggle()</code> 显示/隐藏弹窗</p> <p>更多解析请看git项目：https://gitee.com/zhkumsg/date-selector</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">5/6/2020, 3:11:47 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/log/how-to-do-out-side-click.html" class="prev">如何实现out-side-click功能</a></span> <span class="next"><a href="/log/how-to-access-buried-point-quickly-under-vue.html">在vue下如何快速接入埋点</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.3328e81d.js" defer></script><script src="/assets/js/2.c715c0f2.js" defer></script><script src="/assets/js/29.29379faf.js" defer></script>
  </body>
</html>
