<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>手把手，教你用nodejs搭建后台最小系统（大量图文）系列二 | Wiki文档中心</title>
    <meta name="description" content="描述">
    <link rel="icon" href="/logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.4d8ba4a7.css" as="style"><link rel="preload" href="/assets/js/app.3328e81d.js" as="script"><link rel="preload" href="/assets/js/2.c715c0f2.js" as="script"><link rel="preload" href="/assets/js/34.fb2e76ab.js" as="script"><link rel="prefetch" href="/assets/js/10.abfcde09.js"><link rel="prefetch" href="/assets/js/11.3ee26f26.js"><link rel="prefetch" href="/assets/js/12.45406b92.js"><link rel="prefetch" href="/assets/js/13.7aa97305.js"><link rel="prefetch" href="/assets/js/14.34708031.js"><link rel="prefetch" href="/assets/js/15.76570f77.js"><link rel="prefetch" href="/assets/js/16.29d4e7cd.js"><link rel="prefetch" href="/assets/js/17.eda984dd.js"><link rel="prefetch" href="/assets/js/18.1bb9f9b9.js"><link rel="prefetch" href="/assets/js/19.231ae034.js"><link rel="prefetch" href="/assets/js/20.26a455ac.js"><link rel="prefetch" href="/assets/js/21.62f18186.js"><link rel="prefetch" href="/assets/js/22.177e8b0f.js"><link rel="prefetch" href="/assets/js/23.60274af5.js"><link rel="prefetch" href="/assets/js/24.0ea00a49.js"><link rel="prefetch" href="/assets/js/25.3d5be951.js"><link rel="prefetch" href="/assets/js/26.19229e66.js"><link rel="prefetch" href="/assets/js/27.6d99c0ab.js"><link rel="prefetch" href="/assets/js/28.d28de4e0.js"><link rel="prefetch" href="/assets/js/29.29379faf.js"><link rel="prefetch" href="/assets/js/3.90a63800.js"><link rel="prefetch" href="/assets/js/30.9fe6691b.js"><link rel="prefetch" href="/assets/js/31.2c753b40.js"><link rel="prefetch" href="/assets/js/32.b87ed25b.js"><link rel="prefetch" href="/assets/js/33.69099052.js"><link rel="prefetch" href="/assets/js/35.41f3d46b.js"><link rel="prefetch" href="/assets/js/36.78adf827.js"><link rel="prefetch" href="/assets/js/37.6cb8f1dc.js"><link rel="prefetch" href="/assets/js/38.3296535c.js"><link rel="prefetch" href="/assets/js/39.852ec6ec.js"><link rel="prefetch" href="/assets/js/4.338175e6.js"><link rel="prefetch" href="/assets/js/40.4f030cd4.js"><link rel="prefetch" href="/assets/js/41.7b948635.js"><link rel="prefetch" href="/assets/js/42.7038bdd7.js"><link rel="prefetch" href="/assets/js/43.09ba85b3.js"><link rel="prefetch" href="/assets/js/44.30c43542.js"><link rel="prefetch" href="/assets/js/45.7fc52c71.js"><link rel="prefetch" href="/assets/js/46.e57513f1.js"><link rel="prefetch" href="/assets/js/47.79ad04e1.js"><link rel="prefetch" href="/assets/js/48.806e5af9.js"><link rel="prefetch" href="/assets/js/49.1e083288.js"><link rel="prefetch" href="/assets/js/5.15ce4230.js"><link rel="prefetch" href="/assets/js/50.eef1990e.js"><link rel="prefetch" href="/assets/js/51.cdde33a8.js"><link rel="prefetch" href="/assets/js/52.bcb09293.js"><link rel="prefetch" href="/assets/js/53.87c2baec.js"><link rel="prefetch" href="/assets/js/54.4d9707e7.js"><link rel="prefetch" href="/assets/js/55.5fb2a242.js"><link rel="prefetch" href="/assets/js/56.63b1cb46.js"><link rel="prefetch" href="/assets/js/57.4108fa62.js"><link rel="prefetch" href="/assets/js/58.38c656c4.js"><link rel="prefetch" href="/assets/js/59.2e9da043.js"><link rel="prefetch" href="/assets/js/6.4db8bcb4.js"><link rel="prefetch" href="/assets/js/60.62a9603a.js"><link rel="prefetch" href="/assets/js/61.70db4cce.js"><link rel="prefetch" href="/assets/js/62.c0b27237.js"><link rel="prefetch" href="/assets/js/63.a1ff59d9.js"><link rel="prefetch" href="/assets/js/64.ba32929f.js"><link rel="prefetch" href="/assets/js/65.504fa9a6.js"><link rel="prefetch" href="/assets/js/66.39a7e2d4.js"><link rel="prefetch" href="/assets/js/67.409ffc00.js"><link rel="prefetch" href="/assets/js/68.21b084fc.js"><link rel="prefetch" href="/assets/js/69.1d10efe9.js"><link rel="prefetch" href="/assets/js/7.6832275b.js"><link rel="prefetch" href="/assets/js/70.0391f331.js"><link rel="prefetch" href="/assets/js/71.af289666.js"><link rel="prefetch" href="/assets/js/72.9a8504b0.js"><link rel="prefetch" href="/assets/js/73.0d35f166.js"><link rel="prefetch" href="/assets/js/74.75cd3652.js"><link rel="prefetch" href="/assets/js/75.53679119.js"><link rel="prefetch" href="/assets/js/76.5ea9dd36.js"><link rel="prefetch" href="/assets/js/77.95fe4c15.js"><link rel="prefetch" href="/assets/js/78.aaff367b.js"><link rel="prefetch" href="/assets/js/8.3662cfcf.js"><link rel="prefetch" href="/assets/js/9.a40092b3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4d8ba4a7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Wiki文档中心" class="logo"> <span class="site-name can-hide">Wiki文档中心</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/introduce/" class="nav-link">指南</a></div><div class="nav-item"><a href="/sso/" class="nav-link">单点登录</a></div><div class="nav-item"><a href="/seo/" class="nav-link">服务端渲染</a></div><div class="nav-item"><a href="/linux/" class="nav-link">Linux基础</a></div><div class="nav-item"><a href="/http/" class="nav-link">解读Http</a></div><div class="nav-item"><a href="/microfrontend/" class="nav-link">微前端</a></div><div class="nav-item"><a href="/weixin/" class="nav-link">微信全家桶</a></div><div class="nav-item"><a href="/performance/" class="nav-link">性能优化</a></div><div class="nav-item"><a href="/log/" class="nav-link router-link-active">每日随笔</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/introduce/" class="nav-link">指南</a></div><div class="nav-item"><a href="/sso/" class="nav-link">单点登录</a></div><div class="nav-item"><a href="/seo/" class="nav-link">服务端渲染</a></div><div class="nav-item"><a href="/linux/" class="nav-link">Linux基础</a></div><div class="nav-item"><a href="/http/" class="nav-link">解读Http</a></div><div class="nav-item"><a href="/microfrontend/" class="nav-link">微前端</a></div><div class="nav-item"><a href="/weixin/" class="nav-link">微信全家桶</a></div><div class="nav-item"><a href="/performance/" class="nav-link">性能优化</a></div><div class="nav-item"><a href="/log/" class="nav-link router-link-active">每日随笔</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/log/" class="sidebar-link">随笔</a></li><li><a href="/log/how-to-use-prerender-spa-plugin.html" class="sidebar-link">prerender-spa-plugin预渲染进行seo优化</a></li><li><a href="/log/how-to-create-scroll-module.html" class="sidebar-link">vue项目封装并发布无限滚动指令优化渲染性能的npm模块</a></li><li><a href="/log/how-to-config-cdn-in-webpack.html" class="sidebar-link">webpack使用HtmlWebpackPlugin进行cdn配置</a></li><li><a href="/log/what-does-life-cycle-mean.html" class="sidebar-link">对于“钩子函数”的理解</a></li><li><a href="/log/how-to-append-router-in-extdotnet.html" class="sidebar-link">给EXT. NET管理系统添加路由</a></li><li><a href="/log/what-about-insert-vue-into-extdotnet.html" class="sidebar-link">关于在EXT.NET页面中嵌入vue的弊端与应对方法</a></li><li><a href="/log/using-python-to-simulate-browser-behavior.html" class="sidebar-link">关于python模拟浏览器行为</a></li><li><a href="/log/how-to-quick-in-cmd.html" class="sidebar-link">快速进入此目录的命令窗口</a></li><li><a href="/log/how-to-use-nodejs-build-mini-project-1.html" class="sidebar-link">手把手，教你用nodejs搭建后台最小系统（大量图文）系列一</a></li><li><a href="/log/how-to-use-nodejs-build-mini-project-2.html" class="active sidebar-link">手把手，教你用nodejs搭建后台最小系统（大量图文）系列二</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/log/how-to-use-vue-in-vs2010.html" class="sidebar-link">在VS2010下利用vue开发团队项目</a></li><li><a href="/log/what-is-vue-css-scoped.html" class="sidebar-link">Vue下是如何实现CSS私有作用域的</a></li><li><a href="/log/webpack-base-use.html" class="sidebar-link">webpack的基本使用</a></li><li><a href="/log/how-to-do-out-side-click.html" class="sidebar-link">如何实现out-side-click功能</a></li><li><a href="/log/how-to-do-date-selector.html" class="sidebar-link">手摸手系统：使用原生JS封装时间区间选择器插件</a></li><li><a href="/log/how-to-access-buried-point-quickly-under-vue.html" class="sidebar-link">在vue下如何快速接入埋点</a></li><li><a href="/log/how-to-engineer-front-end-projects.html" class="sidebar-link">如何工程化前端项目</a></li><li><a href="/log/engineering-project.html" class="sidebar-link">工程化项目</a></li><li><a href="/log/vpn.html" class="sidebar-link">Ubuntu 安装OpenVPN客户端GUI</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="手把手，教你用nodejs搭建后台最小系统（大量图文）系列二"><a href="#手把手，教你用nodejs搭建后台最小系统（大量图文）系列二" class="header-anchor">#</a> 手把手，教你用nodejs搭建后台最小系统（大量图文）系列二</h1> <p>前段时间利用nodejs封装了一个最小系统，也终于是把很久之前的愿望给实现了，在这里把如何实现分享出来。</p> <p>本系列文章有两篇，上一篇详见下面传送门：</p> <p>传送门：<a href="https://www.jianshu.com/p/ebef9ffb7851" target="_blank" rel="noopener noreferrer">《手摸手，教你用nodejs搭建后台最小系统（大量图文）系列一》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>项目地址：<a href="https://gitee.com/zhkumsg/node-base-demo" target="_blank" rel="noopener noreferrer">https://gitee.com/zhkumsg/node-base-demo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-c9e8e8e468bad80c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>原文再续，书接上一回~~~</p> <h3 id="_8、开发底层模块"><a href="#_8、开发底层模块" class="header-anchor">#</a> 8、开发底层模块</h3> <p>》common/SortParam.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> MType <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./MType&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Direction <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./Direction&quot;</span><span class="token punctuation">)</span>

<span class="token comment">//定义SortParam实体类（排序字段）</span>

<span class="token keyword">const</span> propertys <span class="token operator">=</span> <span class="token punctuation">[</span>

    <span class="token string">&quot;Type&quot;</span><span class="token punctuation">,</span>

    <span class="token string">&quot;Field&quot;</span><span class="token punctuation">,</span>

    <span class="token string">&quot;SortDirection&quot;</span>

<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">SortParam</span> <span class="token punctuation">{</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        propertys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Type <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Type <span class="token operator">=</span> MType<span class="token punctuation">.</span>Mstring<span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Field <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Field <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>SortDirection <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>SortDirection <span class="token operator">=</span> Direction<span class="token punctuation">.</span><span class="token constant">ASC</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> name <span class="token keyword">in</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>propertys<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                    <span class="token keyword">this</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>

                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> SortParam<span class="token punctuation">;</span>
</code></pre></div><p><strong>这是一个与前面MType和Direction枚举相关的实体类，作用是表明字段采用何种排序方式</strong>。 SortParam实体类有三个属性,Type字段类型、Field字段名字、SortDirection排序方式。</p> <p>其中Type属性是MType的枚举，Field属性是字符串、SortDirection属性是Direction枚举。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">SortParam</span><span class="token punctuation">(</span><span class="token punctuation">{</span> Field<span class="token operator">:</span> <span class="token string">&quot;ZK_ID&quot;</span><span class="token punctuation">,</span> Type<span class="token operator">:</span> MType<span class="token punctuation">.</span>Mstring<span class="token punctuation">,</span> SortDirection<span class="token operator">:</span> Direction<span class="token punctuation">.</span><span class="token constant">ASC</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这表明是<strong>新建一个SortParam实例，对字符串类型的ZK_ID字段采用正序排列</strong>。</p> <hr> <p>》commom/MemoryCondition.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> MType <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./MType&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> MLogic <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./MLogic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> MOperator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./MOperator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//定义MemoryCondition实体类（查询条件）</span>

<span class="token keyword">const</span> propertys <span class="token operator">=</span> <span class="token punctuation">[</span>

    <span class="token string">&quot;Type&quot;</span><span class="token punctuation">,</span>

    <span class="token string">&quot;Field&quot;</span><span class="token punctuation">,</span>

    <span class="token string">&quot;Operator&quot;</span><span class="token punctuation">,</span>

    <span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span>

    <span class="token string">&quot;Logic&quot;</span><span class="token punctuation">,</span>

    <span class="token string">&quot;subCondition&quot;</span>

<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MemoryCondition</span> <span class="token punctuation">{</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        propertys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Type <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Type <span class="token operator">=</span> MType<span class="token punctuation">.</span>Mstring<span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Field <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Field <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Operator <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Operator <span class="token operator">=</span> MOperator<span class="token punctuation">.</span>Like<span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Logic <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Logic <span class="token operator">=</span> MLogic<span class="token punctuation">.</span>And<span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> name <span class="token keyword">in</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>propertys<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                    <span class="token keyword">this</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>

                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MemoryCondition<span class="token punctuation">;</span>
</code></pre></div><p>查询条件实体类。该实体类有六个参数，其代表意义如下：</p> <div class="language- extra-class"><pre class="language-text"><code>MemoryCondition.Type：字段类型（MType枚举）

MemoryCondition.Field：字段名称（字符串）

MemoryCondition.Operator：匹配逻辑（MOperator 枚举） 

MemoryCondition.value：值（任意类型）

MemoryCondition.Logic：条件间关系（MLogic枚举）

MemoryCondition.subCondition：子查询（这里用不上，该功能用于多表查询）  
</code></pre></div><p>比如查询用户表中，用户主键为admin，写法如下（该写法将会经常用）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">MemoryCondition</span><span class="token punctuation">(</span><span class="token punctuation">{</span> Type<span class="token operator">:</span> MType<span class="token punctuation">.</span>Mstring<span class="token punctuation">,</span> Field<span class="token operator">:</span> <span class="token string">&quot;ZK_ID&quot;</span><span class="token punctuation">,</span> Operator<span class="token operator">:</span> MOperator<span class="token punctuation">.</span>Equal<span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span> Logic<span class="token operator">:</span> MLogic<span class="token punctuation">.</span>And <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>其中Type属性默认为MType.Mstring，Operator属性默认为MOperator.Like，Logic属性默认为MLogic.And。<strong>Field和value为必传字段。</strong></p> <p>上面的查询条件将会被Single底层翻译成</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">where</span> ZK_ID <span class="token operator">=</span> <span class="token string">'admin'</span>
</code></pre></div><hr> <p>》common/MemoryResult.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//定义MemoryResult实体类（查询结果）</span>

<span class="token keyword">const</span> propertys <span class="token operator">=</span> <span class="token punctuation">[</span>

    <span class="token string">&quot;recordcount&quot;</span><span class="token punctuation">,</span>

    <span class="token string">&quot;pagecount&quot;</span><span class="token punctuation">,</span>

    <span class="token string">&quot;result&quot;</span><span class="token punctuation">,</span>

    <span class="token string">&quot;ErrorMsg&quot;</span>

<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MemoryResult</span> <span class="token punctuation">{</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        propertys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">&quot;recordcount&quot;</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">&quot;recordcount&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">&quot;pagecount&quot;</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">&quot;pagecount&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">&quot;result&quot;</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">&quot;result&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">&quot;ErrorMsg&quot;</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">&quot;ErrorMsg&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> name <span class="token keyword">in</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>propertys<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                    <span class="token keyword">this</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>

                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MemoryResult<span class="token punctuation">;</span>
</code></pre></div><p>对于每一个sql搜索（查询），返回的结果都不一定一样，所以我们封装了一个实体类，用于包装返回结果，其包括recordcount查询总数、pagecount当前页码、result结果集（类似于C#下的DataTable，这里是数组）和ErrorMsg错误信息四个属性。</p> <p><strong>调用通用查询后将返回该实体类。</strong></p> <hr> <p>》common/ServiceClient.js</p> <p>在前面新建的11个文件中，简单的9个已经介绍完毕，现在正式开始介绍通用查询。在开始介绍通用查询底层前，我们先看一下通用查询的时序图</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-ea228eaa1ebd5999.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>通用查询时序图</p> <p>可以看到，ServiceClient主要是做switch判断、Single做sql语句拼接、DataAccess做数据访问。这里先介绍ServiceClient.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> TableCfg<span class="token punctuation">,</span> QueryModel<span class="token punctuation">,</span> Single <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./common.module'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span>

    <span class="token constant">ZK_USERINFO</span><span class="token punctuation">,</span>

    <span class="token constant">ZK_PERMITINFO</span><span class="token punctuation">,</span>

    <span class="token constant">ZK_PERMITCONFIG</span><span class="token punctuation">,</span>

    <span class="token constant">ZK_ROLEINFO</span><span class="token punctuation">,</span>

    <span class="token constant">ZK_PARAMINFO</span><span class="token punctuation">,</span>

    <span class="token constant">ZK_INVESTMENT</span>

<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../model/model.module'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> ServiceClient <span class="token operator">=</span> <span class="token punctuation">{</span>

    <span class="token comment">/**

    * 通用查询

    * @param {*} model 实体枚举

    * @param {*} condition 条件

    * @param {*} size 类型

    * @param {*} pagesize 每页条数

    * @param {*} pageno 页码

    * @param {*} isPager 是否分页

    * @param {SortParam} sp 排序

    */</span>

    <span class="token function">Query</span><span class="token punctuation">(</span><span class="token parameter">model<span class="token punctuation">,</span> condition<span class="token punctuation">,</span> size<span class="token punctuation">,</span> pagesize<span class="token punctuation">,</span> pageno<span class="token punctuation">,</span> isPager<span class="token punctuation">,</span> sp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">switch</span> <span class="token punctuation">(</span>model<span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">case</span> QueryModel<span class="token punctuation">.</span><span class="token constant">ZK_USERINFO</span><span class="token operator">:</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getqueryPara</span><span class="token punctuation">(</span><span class="token constant">ZK_USERINFO</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>

            <span class="token keyword">case</span> QueryModel<span class="token punctuation">.</span><span class="token constant">ZK_PERMITINFO</span><span class="token operator">:</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getqueryPara</span><span class="token punctuation">(</span><span class="token constant">ZK_PERMITINFO</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>

            <span class="token keyword">case</span> QueryModel<span class="token punctuation">.</span><span class="token constant">ZK_PERMITCONFIG</span><span class="token operator">:</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getqueryPara</span><span class="token punctuation">(</span><span class="token constant">ZK_PERMITCONFIG</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>

            <span class="token keyword">case</span> QueryModel<span class="token punctuation">.</span><span class="token constant">ZK_ROLEINFO</span><span class="token operator">:</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getqueryPara</span><span class="token punctuation">(</span><span class="token constant">ZK_ROLEINFO</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>

            <span class="token keyword">case</span> QueryModel<span class="token punctuation">.</span><span class="token constant">ZK_PARAMINFO</span><span class="token operator">:</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getqueryPara</span><span class="token punctuation">(</span><span class="token constant">ZK_PARAMINFO</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>

            <span class="token keyword">case</span> QueryModel<span class="token punctuation">.</span><span class="token constant">ZK_INVESTMENT</span><span class="token operator">:</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getqueryPara</span><span class="token punctuation">(</span><span class="token constant">ZK_INVESTMENT</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">return</span> Single<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> condition<span class="token punctuation">,</span> size<span class="token punctuation">,</span> pagesize<span class="token punctuation">,</span> pageno<span class="token punctuation">,</span> isPager<span class="token punctuation">,</span> sp<span class="token punctuation">,</span> result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

            <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;实体枚举错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">/**

    * 读取配置文件，获取表名以和主键

    * @param {*} m 实体类

    */</span>

    <span class="token function">getqueryPara</span><span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>TableCfg<span class="token punctuation">[</span>m<span class="token punctuation">.</span>name<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>TableCfg<span class="token punctuation">[</span>m<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

            result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyNames</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">m</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;EB_ISDELETE&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> <span class="token string">&quot;false&quot;</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> result<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> ServiceClient<span class="token punctuation">;</span>
</code></pre></div><p>该对象中有两个方法，Query和getqueryPara，前者是查询接口，后者是是查找数据表对应情况的方法。</p> <p>先说getqueryPara方法，它是通过读取TableCfg.js数据库映射文件，找到当前查询的表名和主键，最后在通过Object.getOwnPropertyNames方法实现判断是否存在EB_ISDELETE字段，判断EB_ISDELETE字段的意义是后续默认添加EB_ISDELETE='0'的判断（因为我们的系统默认是做逻辑删除，不做物理删除）。</p> <p>对于Query方法，它接受<strong>model 实体枚举、condition 条件、size 类型、pagesize 每页条数、pageno 页码、isPager 是否分页、sp 排序</strong>共七个参数。内部根据查询枚举获取对应表名、主键和EB_ISDELETE字段情况，最后调用Single下的query方法（该方法将返回Promise实体，异步回调）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">return</span> Single<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> condition<span class="token punctuation">,</span> size<span class="token punctuation">,</span> pagesize<span class="token punctuation">,</span> pageno<span class="token punctuation">,</span> isPager<span class="token punctuation">,</span> sp<span class="token punctuation">,</span> result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>PS1：前面没有介绍过_common/common.module.js_这个文件，其实它和_model/model.module.js_一样，都是把当前文件夹的全部文件统一导出。<br>
PS2：Object.getOwnPropertyNames是js原生方法，用于遍历自身属性，<strong><a href="https://www.cnblogs.com/vaevvaev/p/6995639.html" target="_blank" rel="noopener noreferrer">相当于OOP下反射<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></strong>。</p> <hr> <p>》common/Single.js</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-05eb93f6e71c8fd9.gif?imageMogr2/auto-orient/strip" alt=""></p> <p>没错，是到最重要的时候了，现在开始终于进入Single的介绍了。<br>
Single.js可以算是通用查询的核心了，在该文件中实现了拼接sql字符串的目标，先大概看一下Single文件。</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-a147ef089bad83a7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>Single.query查询方法，生成基础sql语据</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**

    * 通用查询

    * @param {*} tablename 表名

    * @param {*} condition 条件

    * @param {*} size

    * @param {*} pagesize

    * @param {*} pageno

    * @param {*} isPager 是否分页

    * @param {SortParam} sp 排序

    * @param {*} flag 是否有EB_ISDELETE字段

    */</span>

    <span class="token function">query</span><span class="token punctuation">(</span><span class="token parameter">tablename<span class="token punctuation">,</span> condition<span class="token punctuation">,</span> size<span class="token punctuation">,</span> pagesize<span class="token punctuation">,</span> pageno<span class="token punctuation">,</span> isPager<span class="token punctuation">,</span> sp<span class="token punctuation">,</span> flag</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">let</span> sql <span class="token operator">=</span> <span class="token string">&quot;select * from &quot;</span> <span class="token operator">+</span> tablename<span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">===</span> <span class="token string">&quot;false&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            sql <span class="token operator">+=</span> <span class="token string">&quot; where EB_ISDELETE = '0'&quot;</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">querySQL</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> condition<span class="token punctuation">,</span> size<span class="token punctuation">,</span> pagesize<span class="token punctuation">,</span> pageno<span class="token punctuation">,</span> isPager<span class="token punctuation">,</span> sp<span class="token punctuation">,</span> flag<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p><img src="http://upload-images.jianshu.io/upload_images/13908708-978fd487440a4eb2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>Single.getwhere拼接where条件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**

    * 获取条件语句

    * @param {*} condition 条件

    * @param {*} flag

    */</span>

    <span class="token function">getwhere</span><span class="token punctuation">(</span><span class="token parameter">condition<span class="token punctuation">,</span> flag</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">let</span> sqlwhereall <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

            <span class="token comment">//条件判断较多，具体代码见后面的github链接</span>

            <span class="token keyword">return</span> sqlwhereall<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
</code></pre></div><p><img src="http://upload-images.jianshu.io/upload_images/13908708-c2bfcf08c82a463d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>Single.querySQL 根据基础sql语句和where条件，再根据分页情况调用数据访问底层</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**

    * 执行查询(promise)

    * @param {*} sql 基础sql语句

    * @param {*} condition 条件

    * @param {*} size

    * @param {*} pagesize

    * @param {*} pageno

    * @param {*} isPager

    * @param {SortParam} sp

    * @param {*} flag

    */</span>

    <span class="token function">querySQL</span><span class="token punctuation">(</span><span class="token parameter">sql<span class="token punctuation">,</span> condition<span class="token punctuation">,</span> size<span class="token punctuation">,</span> pagesize<span class="token punctuation">,</span> pageno<span class="token punctuation">,</span> isPager<span class="token punctuation">,</span> sp<span class="token punctuation">,</span> flag</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">let</span> ms <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MemoryResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        sql <span class="token operator">=</span> sql <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getwhere</span><span class="token punctuation">(</span>condition<span class="token punctuation">,</span> flag<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>isPager<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                ds<span class="token punctuation">.</span><span class="token function">GetTable</span><span class="token punctuation">(</span><span class="token string">&quot;select count(1) as sam from (&quot;</span> <span class="token operator">+</span> sql <span class="token operator">+</span> <span class="token string">&quot;) as myTemp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dt<span class="token punctuation">,</span> err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                        <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

                        <span class="token keyword">if</span> <span class="token punctuation">(</span>dt<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                            ms<span class="token punctuation">.</span>recordcount <span class="token operator">=</span> Number<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>dt<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>sam<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                            ms<span class="token punctuation">.</span>pagecount <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>ms<span class="token punctuation">.</span>recordcount <span class="token operator">/</span> pagesize<span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token punctuation">}</span>

                        ds<span class="token punctuation">.</span><span class="token function">GetTable</span><span class="token punctuation">(</span>ds<span class="token punctuation">.</span><span class="token function">datapagerSql</span><span class="token punctuation">(</span>pageno<span class="token punctuation">,</span> pagesize<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> sp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dt<span class="token punctuation">,</span> err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

                            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                                <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>

                            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

                                ms<span class="token punctuation">.</span>result <span class="token operator">=</span> dt<span class="token punctuation">;</span>

                                <span class="token function">resolve</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">;</span>

                            <span class="token punctuation">}</span>

                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token punctuation">}</span>

                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

                ds<span class="token punctuation">.</span><span class="token function">GetTable</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dt<span class="token punctuation">,</span> err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                        <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

                        ms<span class="token punctuation">.</span>result <span class="token operator">=</span> dt<span class="token punctuation">;</span>

                        <span class="token function">resolve</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token punctuation">}</span>

                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> promise<span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>由于篇幅限制，具体代码这里不再粘贴，详细可见github链接（此处该有掌声）。</p> <p><strong>到这里，通用查询开发结束（getwhere方法后续将github链接）。</strong></p> <p>这时候再去执行前面的通用查询就可以正常执行了，可能有小伙伴已经忘了</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> condition <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//查询条件实体类数组</span>

<span class="token keyword">let</span> pagesize <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span> <span class="token comment">//页数</span>

<span class="token keyword">let</span> pageno <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//页码</span>

<span class="token keyword">let</span> sort <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SortParam</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//排序实体类</span>

client<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span>QueryModel<span class="token punctuation">.</span><span class="token constant">ZK_USERINFO</span><span class="token punctuation">,</span> condition<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> pagesize<span class="token punctuation">,</span> pageno<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> sort<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">m</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//分页查询结果</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">throw</span> err<span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>PS：在app.js下测试，测试前需要把配置和文件开发好，最后记得导入文件</p> <p><strong>第四步：实现快速增删改操作</strong></p> <p>经历了前面的通用查询开发后，相信你已经有点累了，然而总开发才完成了四分之一，后面继续下一个四分之一：<strong>实现快速增删改操作。</strong></p> <p>有小伙伴又忍不住要站起来了，嚷嚷着不是用数据访问底层DataAccess的RunQuery不就可以执行增删改了吗？</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-c9940f865634c341.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>这位同学请你坐下！你挡着后面端意大利面的二营长了！</p> <p>是的，你没有说错，这的确可以，<strong>但是</strong>，我说过你可以<strong>不用写一句sql代码就能实现业务开发。</strong></p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-b15a4bb699b78103.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>**第五步：优化ServiceClient底层<br>
**</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-9de63957ebdac906.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p><strong>第六步：开发底层公共方法</strong></p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-7d3b4baa73f8f522.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <h3 id="_9、开发接口路由"><a href="#_9、开发接口路由" class="header-anchor">#</a> 9、开发接口路由</h3> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-13a9824c27f020a1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <h3 id="_10、添加权限判断"><a href="#_10、添加权限判断" class="header-anchor">#</a> 10、添加权限判断</h3> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-a8b8c009011eecef.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <h3 id="_11、实现跨域登陆"><a href="#_11、实现跨域登陆" class="header-anchor">#</a> 11、实现跨域登陆</h3> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-5c9105629381e9e5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <h3 id="_12、踩坑经历"><a href="#_12、踩坑经历" class="header-anchor">#</a> 12、踩坑经历</h3> <p>时间差异、sql事务、参数化查询、global connection、cache、token</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-368fd295148dfc77.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <h3 id="_13、管理系统开发"><a href="#_13、管理系统开发" class="header-anchor">#</a> 13、管理系统开发</h3> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-305cca469a360b8e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">5/6/2020, 3:11:47 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/log/how-to-use-nodejs-build-mini-project-1.html" class="prev">手把手，教你用nodejs搭建后台最小系统（大量图文）系列一</a></span> <span class="next"><a href="/log/how-to-use-vue-in-vs2010.html">在VS2010下利用vue开发团队项目</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.3328e81d.js" defer></script><script src="/assets/js/2.c715c0f2.js" defer></script><script src="/assets/js/34.fb2e76ab.js" defer></script>
  </body>
</html>
