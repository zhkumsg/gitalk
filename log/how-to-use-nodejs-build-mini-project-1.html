<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>手把手，教你用nodejs搭建后台最小系统（大量图文）系列一 | Wiki文档中心</title>
    <meta name="description" content="描述">
    <link rel="icon" href="/logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.4d8ba4a7.css" as="style"><link rel="preload" href="/assets/js/app.3328e81d.js" as="script"><link rel="preload" href="/assets/js/2.c715c0f2.js" as="script"><link rel="preload" href="/assets/js/33.69099052.js" as="script"><link rel="prefetch" href="/assets/js/10.abfcde09.js"><link rel="prefetch" href="/assets/js/11.3ee26f26.js"><link rel="prefetch" href="/assets/js/12.45406b92.js"><link rel="prefetch" href="/assets/js/13.7aa97305.js"><link rel="prefetch" href="/assets/js/14.34708031.js"><link rel="prefetch" href="/assets/js/15.76570f77.js"><link rel="prefetch" href="/assets/js/16.29d4e7cd.js"><link rel="prefetch" href="/assets/js/17.eda984dd.js"><link rel="prefetch" href="/assets/js/18.1bb9f9b9.js"><link rel="prefetch" href="/assets/js/19.231ae034.js"><link rel="prefetch" href="/assets/js/20.26a455ac.js"><link rel="prefetch" href="/assets/js/21.62f18186.js"><link rel="prefetch" href="/assets/js/22.177e8b0f.js"><link rel="prefetch" href="/assets/js/23.60274af5.js"><link rel="prefetch" href="/assets/js/24.0ea00a49.js"><link rel="prefetch" href="/assets/js/25.3d5be951.js"><link rel="prefetch" href="/assets/js/26.19229e66.js"><link rel="prefetch" href="/assets/js/27.6d99c0ab.js"><link rel="prefetch" href="/assets/js/28.d28de4e0.js"><link rel="prefetch" href="/assets/js/29.29379faf.js"><link rel="prefetch" href="/assets/js/3.90a63800.js"><link rel="prefetch" href="/assets/js/30.9fe6691b.js"><link rel="prefetch" href="/assets/js/31.2c753b40.js"><link rel="prefetch" href="/assets/js/32.b87ed25b.js"><link rel="prefetch" href="/assets/js/34.fb2e76ab.js"><link rel="prefetch" href="/assets/js/35.41f3d46b.js"><link rel="prefetch" href="/assets/js/36.78adf827.js"><link rel="prefetch" href="/assets/js/37.6cb8f1dc.js"><link rel="prefetch" href="/assets/js/38.3296535c.js"><link rel="prefetch" href="/assets/js/39.852ec6ec.js"><link rel="prefetch" href="/assets/js/4.338175e6.js"><link rel="prefetch" href="/assets/js/40.4f030cd4.js"><link rel="prefetch" href="/assets/js/41.7b948635.js"><link rel="prefetch" href="/assets/js/42.7038bdd7.js"><link rel="prefetch" href="/assets/js/43.09ba85b3.js"><link rel="prefetch" href="/assets/js/44.30c43542.js"><link rel="prefetch" href="/assets/js/45.7fc52c71.js"><link rel="prefetch" href="/assets/js/46.e57513f1.js"><link rel="prefetch" href="/assets/js/47.79ad04e1.js"><link rel="prefetch" href="/assets/js/48.806e5af9.js"><link rel="prefetch" href="/assets/js/49.1e083288.js"><link rel="prefetch" href="/assets/js/5.15ce4230.js"><link rel="prefetch" href="/assets/js/50.eef1990e.js"><link rel="prefetch" href="/assets/js/51.cdde33a8.js"><link rel="prefetch" href="/assets/js/52.bcb09293.js"><link rel="prefetch" href="/assets/js/53.87c2baec.js"><link rel="prefetch" href="/assets/js/54.4d9707e7.js"><link rel="prefetch" href="/assets/js/55.5fb2a242.js"><link rel="prefetch" href="/assets/js/56.63b1cb46.js"><link rel="prefetch" href="/assets/js/57.4108fa62.js"><link rel="prefetch" href="/assets/js/58.38c656c4.js"><link rel="prefetch" href="/assets/js/59.2e9da043.js"><link rel="prefetch" href="/assets/js/6.4db8bcb4.js"><link rel="prefetch" href="/assets/js/60.62a9603a.js"><link rel="prefetch" href="/assets/js/61.70db4cce.js"><link rel="prefetch" href="/assets/js/62.c0b27237.js"><link rel="prefetch" href="/assets/js/63.a1ff59d9.js"><link rel="prefetch" href="/assets/js/64.ba32929f.js"><link rel="prefetch" href="/assets/js/65.504fa9a6.js"><link rel="prefetch" href="/assets/js/66.39a7e2d4.js"><link rel="prefetch" href="/assets/js/67.409ffc00.js"><link rel="prefetch" href="/assets/js/68.21b084fc.js"><link rel="prefetch" href="/assets/js/69.1d10efe9.js"><link rel="prefetch" href="/assets/js/7.6832275b.js"><link rel="prefetch" href="/assets/js/70.0391f331.js"><link rel="prefetch" href="/assets/js/71.af289666.js"><link rel="prefetch" href="/assets/js/72.9a8504b0.js"><link rel="prefetch" href="/assets/js/73.0d35f166.js"><link rel="prefetch" href="/assets/js/74.75cd3652.js"><link rel="prefetch" href="/assets/js/75.53679119.js"><link rel="prefetch" href="/assets/js/76.5ea9dd36.js"><link rel="prefetch" href="/assets/js/77.95fe4c15.js"><link rel="prefetch" href="/assets/js/78.aaff367b.js"><link rel="prefetch" href="/assets/js/8.3662cfcf.js"><link rel="prefetch" href="/assets/js/9.a40092b3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4d8ba4a7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Wiki文档中心" class="logo"> <span class="site-name can-hide">Wiki文档中心</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/introduce/" class="nav-link">指南</a></div><div class="nav-item"><a href="/sso/" class="nav-link">单点登录</a></div><div class="nav-item"><a href="/seo/" class="nav-link">服务端渲染</a></div><div class="nav-item"><a href="/linux/" class="nav-link">Linux基础</a></div><div class="nav-item"><a href="/http/" class="nav-link">解读Http</a></div><div class="nav-item"><a href="/microfrontend/" class="nav-link">微前端</a></div><div class="nav-item"><a href="/weixin/" class="nav-link">微信全家桶</a></div><div class="nav-item"><a href="/performance/" class="nav-link">性能优化</a></div><div class="nav-item"><a href="/log/" class="nav-link router-link-active">每日随笔</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/introduce/" class="nav-link">指南</a></div><div class="nav-item"><a href="/sso/" class="nav-link">单点登录</a></div><div class="nav-item"><a href="/seo/" class="nav-link">服务端渲染</a></div><div class="nav-item"><a href="/linux/" class="nav-link">Linux基础</a></div><div class="nav-item"><a href="/http/" class="nav-link">解读Http</a></div><div class="nav-item"><a href="/microfrontend/" class="nav-link">微前端</a></div><div class="nav-item"><a href="/weixin/" class="nav-link">微信全家桶</a></div><div class="nav-item"><a href="/performance/" class="nav-link">性能优化</a></div><div class="nav-item"><a href="/log/" class="nav-link router-link-active">每日随笔</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/log/" class="sidebar-link">随笔</a></li><li><a href="/log/how-to-use-prerender-spa-plugin.html" class="sidebar-link">prerender-spa-plugin预渲染进行seo优化</a></li><li><a href="/log/how-to-create-scroll-module.html" class="sidebar-link">vue项目封装并发布无限滚动指令优化渲染性能的npm模块</a></li><li><a href="/log/how-to-config-cdn-in-webpack.html" class="sidebar-link">webpack使用HtmlWebpackPlugin进行cdn配置</a></li><li><a href="/log/what-does-life-cycle-mean.html" class="sidebar-link">对于“钩子函数”的理解</a></li><li><a href="/log/how-to-append-router-in-extdotnet.html" class="sidebar-link">给EXT. NET管理系统添加路由</a></li><li><a href="/log/what-about-insert-vue-into-extdotnet.html" class="sidebar-link">关于在EXT.NET页面中嵌入vue的弊端与应对方法</a></li><li><a href="/log/using-python-to-simulate-browser-behavior.html" class="sidebar-link">关于python模拟浏览器行为</a></li><li><a href="/log/how-to-quick-in-cmd.html" class="sidebar-link">快速进入此目录的命令窗口</a></li><li><a href="/log/how-to-use-nodejs-build-mini-project-1.html" class="active sidebar-link">手把手，教你用nodejs搭建后台最小系统（大量图文）系列一</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/log/how-to-use-nodejs-build-mini-project-2.html" class="sidebar-link">手把手，教你用nodejs搭建后台最小系统（大量图文）系列二</a></li><li><a href="/log/how-to-use-vue-in-vs2010.html" class="sidebar-link">在VS2010下利用vue开发团队项目</a></li><li><a href="/log/what-is-vue-css-scoped.html" class="sidebar-link">Vue下是如何实现CSS私有作用域的</a></li><li><a href="/log/webpack-base-use.html" class="sidebar-link">webpack的基本使用</a></li><li><a href="/log/how-to-do-out-side-click.html" class="sidebar-link">如何实现out-side-click功能</a></li><li><a href="/log/how-to-do-date-selector.html" class="sidebar-link">手摸手系统：使用原生JS封装时间区间选择器插件</a></li><li><a href="/log/how-to-access-buried-point-quickly-under-vue.html" class="sidebar-link">在vue下如何快速接入埋点</a></li><li><a href="/log/how-to-engineer-front-end-projects.html" class="sidebar-link">如何工程化前端项目</a></li><li><a href="/log/engineering-project.html" class="sidebar-link">工程化项目</a></li><li><a href="/log/vpn.html" class="sidebar-link">Ubuntu 安装OpenVPN客户端GUI</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="手把手，教你用nodejs搭建后台最小系统（大量图文）系列一"><a href="#手把手，教你用nodejs搭建后台最小系统（大量图文）系列一" class="header-anchor">#</a> 手把手，教你用nodejs搭建后台最小系统（大量图文）系列一</h1> <p>前言：很久以前就想写这么一篇文章了，因为之前都是用其他语言写后台，但是环境配置不好弄，而且占用运行内存也大，所以趁着这段时间有空，特地开发一套nodejs版的后台。<em>不过需要注意的是nodejs终究是js的拓展，存在着一些隐患，大型项目还是建议使用C#、Java或者php等实现</em>。</p> <p>为了方便理解，先把<strong>在线项目</strong>放出来，需要的小伙伴可以先clone下来：<a href="https://gitee.com/zhkumsg/node-base-demo" target="_blank" rel="noopener noreferrer">https://gitee.com/zhkumsg/node-base-demo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-c8ddfa9b8b62570e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>仙女镇楼</p> <h3 id="_1、简介"><a href="#_1、简介" class="header-anchor">#</a> 1、简介</h3> <p>nodejs兴起已经有一段时间了，功能也是越来越强大，而且听闻百度音乐已经淘宝内部系统都以及在用nodejs了，所以为了完善自己的技术栈，还有有必要了解一下的。</p> <p>那么nodejs难不难呢？真的不难，只要你有js基础和面向对象思想，那么一切问题都是纸老虎。nodejs的语法与js的基本一样，只不过普通js使用es5来写的，而nodejs用到的更多是es6甚至es7。</p> <p>那nodejs能干嘛呢？怎么说呢，这样说吧，<strong>NodeJs is Everything</strong>。只有你想不到的，没有nodejs做不到的（有点夸张了哦，不过事实的确如此）。nodejs可以作为**<em>服务端语言</em>**也可以实现爬虫（但是更多的是用python实现），甚至还可以实现大数据分析和人脸识别（尽管精度有待提高）。这里我们只介绍如何用nodejs来实现后台系统的搭建。</p> <p>在本系统中，我们用的语言主要是nodejs，采用的框架是十分流行express框架，所用到的数据库是微软的SQL Server 2008 r2 和mysql数据库。我们的目标是开发一个带有权限限制以及<strong>不用写sql语句</strong>的最小系统（通用后台）。</p> <p>下面先预览一下权限判断以及数据库增删改查操作：</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-72ff753725217292.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>登录及权限判断 check</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Routebase<span class="token punctuation">.</span><span class="token function">IsLogin</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Routebase<span class="token punctuation">.</span><span class="token function">IsPermit</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> <span class="token string">&quot;00017&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div><p><img src="http://upload-images.jianshu.io/upload_images/13908708-7521f6f982ce4b70.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>新增操作 insert</p> <div class="language-js extra-class"><pre class="language-js"><code>ds<span class="token punctuation">.</span><span class="token function">TransRunQuery</span><span class="token punctuation">(</span>Public<span class="token punctuation">.</span><span class="token function">OperationSQLParams</span><span class="token punctuation">(</span>record<span class="token punctuation">,</span> OperationEnum<span class="token punctuation">.</span>Create<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">//ds.TransRunQuery为底层sql操作、Public.OperationSQLParams为底层公共方法、record为实体类实例、OperationEnum.Create为操作枚举</span>
</code></pre></div><p><img src="http://upload-images.jianshu.io/upload_images/13908708-87839491507ebdae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>删除操作 delete</p> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">DeleteByIds</span><span class="token punctuation">(</span><span class="token constant">ZK_PARAMINFO</span><span class="token punctuation">,</span> ids<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">//client.DeleteByIds为底层sql操作方法、ZK_PARAMINFO为实体类、ids为记录的主键</span>
</code></pre></div><p><img src="http://upload-images.jianshu.io/upload_images/13908708-d32f5d4499cc7de7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>更新操作 update</p> <div class="language-js extra-class"><pre class="language-js"><code>ds<span class="token punctuation">.</span><span class="token function">TransRunQuery</span><span class="token punctuation">(</span>Public<span class="token punctuation">.</span><span class="token function">OperationSQLParams</span><span class="token punctuation">(</span>record<span class="token punctuation">,</span> OperationEnum<span class="token punctuation">.</span>Update<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// ds.TransRunQuery为底层sql操作、 Public.OperationSQLParams为底层公共方法、record为实体类实例、 OperationEnum.Update为操作枚举</span>
</code></pre></div><p><img src="http://upload-images.jianshu.io/upload_images/13908708-036ccd90aec0ac49.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>通用查询 select</p> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span>QueryModel<span class="token punctuation">.</span><span class="token constant">ZK_PARAMINFO</span><span class="token punctuation">,</span> condition<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> Number<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>pagesize<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Number<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>pageno<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> sort<span class="token punctuation">)</span>

<span class="token comment">//client.Query为通用查询方法、QueryModel.ZK_PARAMINFO是查询枚举、condition是需要过滤的参数、pagesize和pageno是页数和页码、sort是排序顺序</span>
</code></pre></div><p>是不是很简单，都不用拼接sql就可以完成业务，下面继续介绍这个项目的需求。</p> <h3 id="_2、确定系统需求"><a href="#_2、确定系统需求" class="header-anchor">#</a> 2、确定系统需求</h3> <p>对于每一个系统，只有确定好了需求才能够正确开发，本系统作为一个nodejs的后台最小系统，需求不会特别难，只需要下面几点：</p> <div class="language- extra-class"><pre class="language-text"><code>第一：有用户模块

第二：有权限控制

第三：有列表和详情示范

第三：能快速开发（小白都会用）
</code></pre></div><p>第一点很好理解，也就是该系统必须有用户才行，其中包括用户注册、用户登陆、查看用户信息、修改用户信息、删除用户等功能。</p> <p>对于第二点，也就是第一点的拓展，每一个用户都有一个自己的角色，然后不同角色有不用的操作权限，从而实现不用用户所能查看和维护的数据不一样。</p> <p>第三点，每一个系统都不可避免有信息展示，比如文章系统，或多或少都会有列表与详情的展示。对于列表，能查询、能排序，对于详情，可以修改和查看。</p> <p>第四点，也就是<strong>本系统的核心所在（底层）</strong>，希望开发出来的东西小白都能用。小白只需要复制粘贴代码即可完成一个新模块功能的开发（<em>看到我这篇文章不要关，裹上鸡蛋液，粘上面包糠，下锅炸至金黄酥脆控油捞出，老人小孩都爱看，隔壁小白都馋哭了</em>）。当然这部分设计的东西特别多，后面会特别介绍，不急。</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-9226de0051665366.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>ctrl c  +  ctrl  v</p> <p>那么总的来说有三个核心模块，用户模块、角色模块、权限模块</p> <p>用户模块主要包括：用户主键、用户名、用户密码、用户头像和所属角色等字段；</p> <p>角色模块主要包括：角色主键、角色名、角色等级、是否具备管理权和描述等字段；</p> <p>权限模块包含权限列表与权限分配两个子模块：</p> <p>权限列表子模块(对应的页面)：页面主键、页面路径、页面组件（vue组件）、页面名称、页面图标、是否叶子节点、父级主键等字段；</p> <p>权限分配子模块：分配主键、角色主键、权限主键等字段；</p> <p>除了这几个核心模块，还可以添加_文章系统模块、日志模块和调度模块_，这里不再展开，可自由补充。</p> <p>需要统一说明的是，上面的每一个模块都有几个<strong>公共的字段</strong>，那就是<strong>是否删除、创建人主键、创建时间、最后修改人、最后修改时间</strong>。其中是否删除字段是用来逻辑删除的，毕竟数据是宝贵的，避免误删除后数据无法找回，其他几个创建修改字段是用来记录操作人的。</p> <h3 id="_3、初始化数据库"><a href="#_3、初始化数据库" class="header-anchor">#</a> 3、初始化数据库</h3> <p>有了需求，我们就要创建数据库了，从上面分析我们知道有四个表，分别是：</p> <div class="language- extra-class"><pre class="language-text"><code>用户表：ZK_USERINFO

角色表：ZK_ROLEINFO

权限表：ZK_PERMITINFO

配置表：ZK_PERMITCONFIG
</code></pre></div><p>为了后面介绍方面，这里插入两个表，分别是公共维度表（也就是本系统用到的公共参数）和投融事件表（用来做列表详情演示的），如下：</p> <div class="language- extra-class"><pre class="language-text"><code>公共维度表：ZK_PARAMINFO

投融事件表：ZK_INVESTMENT
</code></pre></div><p><em>PS：ZK为前缀，没有什么特别意义哈，也可换成其他的，只是一个命名习惯。</em></p> <p>那么是时候选择数据库了，本系统采用的主数据库是微软的sql server 2008，主要是因为一直在用，懒得换其他的，有需要也可以换成mysql，主要代码还是一样，稍微改一下连接字符串和查询底层就可以了。<strong>这里以sql server为例</strong>。</p> <p><strong>第一步：先创建数据库</strong>，命名为AuthPublish（如果不是这个命名，后面需要修改连接字符串）</p> <p><strong>第二步：依次创建上面六个表</strong>，为了方便，我直接把创建语句放出来，直接运行即可</p> <p>用户表：ZK_USERINFO</p> <div class="language- extra-class"><pre class="language-text"><code>/****** Object: Table [dbo].[ZK_USERINFO] Script Date: 09/20/2018 17:47:19 ******/SET ANSI_NULLS ONGOSET QUOTED_IDENTIFIER ONGOCREATE TABLE [dbo].[ZK_USERINFO]( [ZK_ID] [nvarchar](50) NOT NULL, [ZK_PASSWORD] [nvarchar](50) NULL, [ZK_NAME] [nvarchar](50) NOT NULL, [ZK_SEX] [nvarchar](4) NULL, [ZK_PHONE] [nvarchar](50) NULL, [ZK_EMAIL] [nvarchar](50) NULL, [ZK_ROLE] [nvarchar](50) NULL, [ZK_DEPARTMENT] [nvarchar](50) NULL, [ZK_ISHANDLER] [nvarchar](4) NULL, [ZK_REMARK] [nvarchar](max) NULL, [ZK_HEAD_PORTRAIT] [nvarchar](1024) NULL, [EB_ISDELETE] [nvarchar](1) NULL, [EB_CREATE_DATETIME] [datetime] NULL, [EB_CREATEBY] [nvarchar](50) NULL, [EB_LASTMODIFY_DATETIME] [datetime] NULL, [EB_LASTMODIFYBY] [nvarchar](50) NULL, [ZK_USERSOURCE] [nvarchar](50) NULL, CONSTRAINT [PK_ZK_USERINFO] PRIMARY KEY CLUSTERED ( [ZK_ID] ASC)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]) ON [PRIMARY]GOEXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'用户表' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'ZK_USERINFO'GO
</code></pre></div><p><img src="http://upload-images.jianshu.io/upload_images/13908708-b25802b95491154a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>用户表 ZK_USERINFO</p> <p>角色表：ZK_ROLEINFO</p> <div class="language- extra-class"><pre class="language-text"><code>/****** Object: Table [dbo].[ZK_ROLEINFO] Script Date: 09/20/2018 17:47:19 ******/SET ANSI_NULLS ONGOSET QUOTED_IDENTIFIER ONGOCREATE TABLE [dbo].[ZK_ROLEINFO]( [ZK_ID] [nvarchar](50) NOT NULL, [ZK_ROLE] [nvarchar](50) NOT NULL, [ZK_DESC] [nvarchar](500) NULL, [ZK_LEAVE] [int] NOT NULL, [ZK_ISADMIN] [nvarchar](1) NOT NULL, [EB_ISDELETE] [nvarchar](1) NULL, [EB_CREATE_DATETIME] [datetime] NULL, [EB_LASTMODIFYBY] [nvarchar](50) NULL, [EB_LASTMODIFY_DATETIME] [datetime] NULL, [EB_CREATEBY] [nvarchar](50) NULL, CONSTRAINT [PK_ZK_ROLEINFO] PRIMARY KEY CLUSTERED ( [ZK_ID] ASC)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]) ON [PRIMARY]GO
</code></pre></div><p><img src="http://upload-images.jianshu.io/upload_images/13908708-e279c387058da3b1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>角色表  ZK_ROLEINFO</p> <p>权限表：ZK_PERMITINFO</p> <div class="language- extra-class"><pre class="language-text"><code>/****** Object: Table [dbo].[ZK_PERMITINFO] Script Date: 09/20/2018 17:47:19 ******/SET ANSI_NULLS ONGOSET QUOTED_IDENTIFIER ONGOCREATE TABLE [dbo].[ZK_PERMITINFO]( [ZK_ID] [nvarchar](50) NOT NULL, [ZK_PATH] [nvarchar](100) NULL, [ZK_COMPONENT] [nvarchar](50) NULL, [ZK_NAME] [nvarchar](32) NULL, [ZK_ISHIDDEN] [nvarchar](1) NULL, [ZK_ICON] [nvarchar](50) NULL, [ZK_ISLEAF] [nvarchar](1) NULL, [ZK_PARENT] [nvarchar](50) NULL, [ZK_SORT] [int] NULL, [EB_ISDELETE] [nvarchar](1) NULL, [EB_CREATE_DATETIME] [datetime] NULL, [EB_LASTMODIFYBY] [nvarchar](50) NULL, [EB_LASTMODIFY_DATETIME] [datetime] NULL, [EB_CREATEBY] [nvarchar](50) NULL, CONSTRAINT [PK_ZK_PERMITINFO] PRIMARY KEY CLUSTERED ( [ZK_ID] ASC)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]) ON [PRIMARY]GOEXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'排序，同级中越小越靠前' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'ZK_PERMITINFO', @level2type=N'COLUMN',@level2name=N'ZK_SORT'GO
</code></pre></div><p><img src="http://upload-images.jianshu.io/upload_images/13908708-bae5d1da1922a47b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>权限表   ZK_PERMITINFO</p> <p>配置表：ZK_PERMITCONFIG</p> <div class="language- extra-class"><pre class="language-text"><code>/****** Object: Table [dbo].[ZK_PERMITCONFIG] Script Date: 09/20/2018 17:47:19 ******/SET ANSI_NULLS ONGOSET QUOTED_IDENTIFIER ONGOCREATE TABLE [dbo].[ZK_PERMITCONFIG]( [ZK_ID] [nvarchar](50) NOT NULL, [ZK_ROLE] [nvarchar](50) NULL, [ZK_PERMITID] [nvarchar](50) NULL, CONSTRAINT [PK_ZK_PERMITCONFIG] PRIMARY KEY CLUSTERED ( [ZK_ID] ASC)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]) ON [PRIMARY]GO
</code></pre></div><p><img src="http://upload-images.jianshu.io/upload_images/13908708-fcc8bed4c2babc2c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>配置表    ZK_PERMITCONFIG</p> <p>公共维度表：ZK_PARAMINFO</p> <div class="language- extra-class"><pre class="language-text"><code>/****** Object: Table [dbo].[ZK_PARAMINFO] Script Date: 09/20/2018 17:47:19 ******/SET ANSI_NULLS ONGOSET QUOTED_IDENTIFIER ONGOCREATE TABLE [dbo].[ZK_PARAMINFO]( [ZK_ID] [nvarchar](50) NOT NULL, [ZK_KEY] [nvarchar](50) NULL, [ZK_VALUE] [nvarchar](250) NULL, [ZK_DESC] [nvarchar](250) NULL, [EB_ISDELETE] [nvarchar](1) NOT NULL, [EB_CREATE_DATETIME] [datetime] NULL, [EB_CREATEBY] [nvarchar](50) NULL, [EB_LASTMODIFY_DATETIME] [datetime] NULL, [EB_LASTMODIFYBY] [nvarchar](50) NULL, CONSTRAINT [PK_ZK_PARAMINFO] PRIMARY KEY CLUSTERED ( [ZK_ID] ASC)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]) ON [PRIMARY]GO
</code></pre></div><p><img src="http://upload-images.jianshu.io/upload_images/13908708-55e292e045467dc5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>公共维度表    ZK_PARAMINFO</p> <p>投融事件表：ZK_INVESTMENT</p> <div class="language- extra-class"><pre class="language-text"><code>/****** Object: Table [dbo].[ZK_INVESTMENT] Script Date: 09/20/2018 17:47:19 ******/SET ANSI_NULLS ONGOSET QUOTED_IDENTIFIER ONGOCREATE TABLE [dbo].[ZK_INVESTMENT]( [ZK_ID] [nvarchar](50) NOT NULL, [ZK_TITLE] [nvarchar](50) NULL, [ZK_LOGO] [nvarchar](200) NULL, [ZK_INDUSTRY] [nvarchar](50) NULL, [ZK_ROUNDS] [nvarchar](50) NULL, [ZK_MONEY] [nvarchar](50) NULL, [ZK_INVESTORS] [nvarchar](200) NULL, [ZK_TIME] [nvarchar](50) NULL, [ZK_DESC] [nvarchar](max) NULL, [ZK_ISSYNC] [nvarchar](1) NULL, [ZK_FOREIGNKEY] [nvarchar](50) NULL, [EB_ISDELETE] [nvarchar](1) NULL, [EB_CREATE_DATETIME] [datetime] NULL, [EB_CREATEBY] [nvarchar](50) NULL, [EB_LASTMODIFYBY] [nvarchar](50) NULL, [EB_LASTMODIFY_DATETIME] [datetime] NULL, CONSTRAINT [PK_ZK_INVESTMENT] PRIMARY KEY CLUSTERED ( [ZK_ID] ASC)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]) ON [PRIMARY]GO
</code></pre></div><p><img src="http://upload-images.jianshu.io/upload_images/13908708-7ed2e722fb2cf2f6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>投融事件表    ZK_INVESTMENT</p> <p>PS:使用其他数据库的小伙伴对照着图片修改下数据类型即可，这里介绍的是sql server数据库。</p> <p>再次声明一下，基本每一个表都会有这几个字段：是否删除、创建人主键、创建时间、最后修改人、最后修改时间。这也用在底层判断上，希望先都加上。</p> <p>到这里，数据库骨架已经搭建完成，下面正式开始代码部分。</p> <h3 id="_4、创建express项目"><a href="#_4、创建express项目" class="header-anchor">#</a> 4、创建express项目</h3> <p>在几年的时间里，node.js逐渐发展成一个成熟的开发平台，吸引了众多开发者，我们常用它来开发一些快速移动Web框架。nodejs下有着许多的web框架，比如Primus、Geddy、Express等，这里以入门简单的express为例。</p> <p>创建express web框架，可以一点一点的创建，也可以用脚手架创建，如果你用过vue-cli，你会被脚手架的方便性深深折服。所以这次我们也是站在巨人的肩膀上，使用脚手架创建express项目。</p> <p><strong>第一步：全局安装express-generator脚手架</strong></p> <p>哎，这时候就有机智的小伙伴发问了，不是应该安装express脚手架吗，怎么是安装express-generator？</p> <p>其实是这样的，express在最新版本上出现了问题，难以成功安装，为了避免踩坑，统一安装express-generator，当然如果express可以正常安装也是可用的，这两个脚手架用法一样。</p> <div class="language- extra-class"><pre class="language-text"><code>全局安装express-generator脚手架

npm install express-generator  -g
</code></pre></div><p><img src="http://upload-images.jianshu.io/upload_images/13908708-8d655ea6e1741658.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>建议使用淘宝镜像</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-2409ba91768df557.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>express  -V  检查是否安装成功</p> <p><em>PS：我试过安装express脚手架，发现是真的安装不上</em></p> <p><strong>第二步：创建express应用</strong></p> <p>和vue-cli脚手架一样，通过简单命令就可以创建一个项目，express也是如此。首先我们去到合适的目录，然后cmd执行以下代码（node-base-demo为项目名字，可换成其他的）：</p> <div class="language- extra-class"><pre class="language-text"><code>express node-base-demo
</code></pre></div><p><img src="http://upload-images.jianshu.io/upload_images/13908708-2c3e1462fe6b80fd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>express node-base-demo</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-f74a29e5d2510b6d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>创建完成</p> <p>此时可以看到目录中多了一个新文件夹node-base-demo</p> <p><strong>第三步：安装依赖</strong></p> <p>既然项目已经创建好了，那当然是去安装依赖呀（可以理解为下载插件和库），首先我们cd进项目文件夹，如下：</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-bc4a1d446a900174.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>cd   node-base-demo</p> <p>闲话不多说，安装依赖使用下面的代码：</p> <div class="language- extra-class"><pre class="language-text"><code>npm install
</code></pre></div><p><img src="http://upload-images.jianshu.io/upload_images/13908708-78abcaf0fc40b053.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>npm install</p> <p>执行该命令时可以使用淘宝镜像cnpm。npm install用来安装依赖（也叫做下载模块），如果不写模块名，那么npm将在当前路径寻找package.json项目文件，然后安装所配置的模块。</p> <p>安装成功后会在项目目录中新建一个node_modules文件夹，如果安装出错（一般来说警告是可以理解的，错误就一定要排除），需要把node_modules文件夹全部删掉，重新npm install。</p> <p><strong>第四步：启动项目</strong></p> <p>具体启动是什么命令呢？除了可以去官网查看启动命令和查看控制台输出外，我在这里推荐一个方法，百试百灵。那就是在cmd中输入：</p> <div class="language- extra-class"><pre class="language-text"><code>npm  run
</code></pre></div><p>npm执行这句话时，会从package.json项目文件中查找全部的命令</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-fd4ba9f2972dc6ea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>npm run</p> <p>这时候我们就很明确知道npm run start就是启动命令了，期待了这么久，那赶紧来启动看看。</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-e9404a9d1640b9cb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>npm  run  start</p> <p><em>明明已经启动了，怎么没有效果呢？</em></p> <p>好吧，这也是我一度疑惑的问题，在vue和react脚手架下，都会自动给我们打开浏览器的呀，怎么这里不会呢？</p> <p>其实这里是正常的，没毛病，项目已经正常启动了，不信你手动在浏览器输入以下网址试一下</p> <div class="language- extra-class"><pre class="language-text"><code>http://localhost:3000
</code></pre></div><p><img src="http://upload-images.jianshu.io/upload_images/13908708-3c990fa65a644b7d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>http://localhost:3000</p> <p>哎，没毛病吧，nodejs不会帮你自动打开浏览器的。</p> <p>如果很不幸，你的项目启动失败，那往往是模块没有全部安装或者端口冲突。模块的问题见我前面说的，删除node_modules文件夹，重新安装一次；如果是端口问题，接着往下看你会得到答案。</p> <p><em>PS：停止运行是通用的命令 CTRL键 + C</em></p> <h3 id="_5、项目结构分析"><a href="#_5、项目结构分析" class="header-anchor">#</a> 5、项目结构分析</h3> <p>对于每一个项目，都要认真分析它的项目结构，这样才有助于我们更好的开发，我们先看一下node-base-demo项目的结构</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-0787c26d9d0d9661.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>node-base-demo 项目结构</p> <div class="language- extra-class"><pre class="language-text"><code>bin：项目核心文件夹，内部有一个www文件，用于创建express实例（修改端口在这里）；

node_modules：模块文件夹，本项目用到的全部依赖都在里面，相当于一个个的插件（自动生成，不用修改）；

public：静态资源文件夹，主要存放css、html、js和图片等（基本不用）；

routes：路由文件夹，放路由逻辑，这是我们核心部分；

views：视图文件夹，主要是一些视图文件（基本不用）；

app.js：入口文件，相当于vue和react下的main.js，这也是我们的核心部分（和www文件类似，一个是逻辑入口，一个是物理入口，只不过www文件我们一般不用改，而app.js则是经常变动）；

package.json：项目文件，存放项目信息；
</code></pre></div><p>为了篇幅考虑，这里先介绍bin/www、app.js和routes/index.js三个文件</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-268962e7b8c107e8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>bin/www</p> <p>bin/www文件主要是创建并启动http服务，一般来说我们是不用修改代码的。但是如果端口冲突无法正常启动，那就需要来稍微修改一下了。该项目的默认端口是3000，如果冲突，直接在第15行修改成其他端口就可以了（前面说端口冲突的小伙伴看到这个解决方案了吗？）。</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-4fe2e76230f10190.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>app.js</p> <p>app.js可以理解成入口文件，里面主要是加载创建express实例，然后配置路由（其实还有更重要的拦截器、也可以叫过滤器，后面再说）。注意第22-23行</p> <div class="language- extra-class"><pre class="language-text"><code>app.use('/', indexRouter); 
app.use('/users', usersRouter);
</code></pre></div><p>这两句话的意思是说，如果我的路径是http:localhost:3000/，那么我使用indexRouter路由；如果我的路径是http:localhost:3000/users，那么我使用usesRouter路由。</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-71a489300a17ebc0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>index.js</p> <p>routes/index.js是路由的具体实现，这个文件最终导出一个express.router实例，这里面的代码意思是说，在当前路由下，如果路径是“/”，那么返回index视图。其中req为请求，res为响应，通过req可以拿到请求参数和请求头等信息，通过res可以执行响应。</p> <p>在本系统下，基本不会用到视图，上面的res.render()一般改成res.send()。如routes/user.js</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-ff56edc37881e731.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>res.send(************)</p> <p>如果想测试，直接把index.js下的响应改成res.send(************)即可，如果想新建一个api，可以添加下面的代码</p> <div class="language-js extra-class"><pre class="language-js"><code>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/test'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这样浏览器打开http://localhost:3000/test就可以看到返回的信息。</p> <p>哎~，机智的你又发现问题了，我明明已经改了响应内容了，为什么页面没有效果呢？</p> <p>很遗憾告诉你，express-generator不支持热加载，你得重新启动才可以。</p> <div class="language- extra-class"><pre class="language-text"><code>npm run start
</code></pre></div><p>的确有点麻烦，每次修改都得重新启动一下，不过办法还是有滴，接着往下看吧。</p> <h3 id="_6、安装热加载nodemon模块"><a href="#_6、安装热加载nodemon模块" class="header-anchor">#</a> 6、安装热加载nodemon模块</h3> <p>用习惯了webpack的热加载，在express-generator下每次修改都要重新启动的确有点悲催，这时候是时候祭出nodemon模块了。</p> <p>nodemon模块是一个支持在express下热启动的模块，安装和使用都非常简单。</p> <p><strong>第一步：安装nodemon</strong></p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-c0d36dc3d5d7da18.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>安装nodemon模块</p> <div class="language- extra-class"><pre class="language-text"><code>cnpm install nodemon --save-dev
</code></pre></div><p><em>加--save-dev或者--save可是一个好习惯</em>，这样可以把项目依赖情况写入项目文件中，共享项目的时候提供package.json就可以了。</p> <p><strong>第二步：配置nodemon</strong></p> <p>怎么在node项目中添加自己的命令脚本呢？其实很简单，需要修改package.json下的scripts就可以了（是通用的，其他脚手架下也一样），我们添加以下命令：</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;dev&quot;: &quot;nodemon ./bin/www&quot;
</code></pre></div><p>添加命令为dev主要是为了规范，因为一般开发环境都是用dev命令的，也可以改成其他的。</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-8b59f935a6a723ea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>package.json</p> <p><strong>第三步：使用nodemon</strong></p> <p>这时候npm命令就有两个了，一个是start，一个是dev。我们在cmd下执行dev命令</p> <div class="language- extra-class"><pre class="language-text"><code>npm  run  dev
</code></pre></div><p><img src="http://upload-images.jianshu.io/upload_images/13908708-f58e2dd6bc5b7a9f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>执行dev脚本</p> <p>项目正常启动，这时候如果代码发生改动，该项目会自动重启，如下</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-cf49fd7d34f29d40.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>修改index.js</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-21723dfdbfd3520a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>自动重启</p> <p>会发现项目被自动重启，这时候刷新http://localhost:3000会看到最新信息，再也不需要手动启动项目了（手动刷新还是要的）</p> <p>项目结构基本介绍完了，下面正式开始说具体业务代码。</p> <h3 id="_7、开发数据模型（model）"><a href="#_7、开发数据模型（model）" class="header-anchor">#</a> 7、开发数据模型（model）</h3> <p>其实开发这个系统的时候，主要是吸取了MVC思路和ORM的一些想法，我们把数据模型与数据库表一一对应起来，操作数据模型（model）就相当于操作数据库表。</p> <p>按照我们前面时候说的需求分析，我们创建了几个表，分别是ZK_USERINFO、ZK_ROLEINFO、ZK_PERMITINFO、ZK_PERMITCONFIG、ZK_PARAMINFO和ZK_INVESTMENT共六张基础表。</p> <p>接着我们对应这六张表，创建六个实体类（数据模型），各个实体类的属性与表字段一一对应。</p> <p>首先我们在根目录创建一个model文件夹，然后依次创建ZK_USERINFO.js ~~~~ZK_INVESTMENT.js等六个文件，这里以ZK_USERINFO.js为例，其内容为</p> <p>//定义ZK_USERINFO实体类</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> propertys <span class="token operator">=</span> <span class="token punctuation">[</span>

    <span class="token string">&quot;ZK_ID&quot;</span><span class="token punctuation">,</span>

    <span class="token string">&quot;ZK_PASSWORD&quot;</span><span class="token punctuation">,</span>

    <span class="token string">&quot;ZK_NAME&quot;</span><span class="token punctuation">,</span>

    <span class="token string">&quot;ZK_SEX&quot;</span><span class="token punctuation">,</span>

    <span class="token string">&quot;ZK_PHONE&quot;</span><span class="token punctuation">,</span>

    <span class="token string">&quot;ZK_EMAIL&quot;</span><span class="token punctuation">,</span>

    <span class="token string">&quot;ZK_ROLE&quot;</span><span class="token punctuation">,</span>

    <span class="token string">&quot;ZK_DEPARTMENT&quot;</span><span class="token punctuation">,</span>

    <span class="token string">&quot;ZK_ISHANDLER&quot;</span><span class="token punctuation">,</span>

    <span class="token string">&quot;ZK_REMARK&quot;</span><span class="token punctuation">,</span>

    <span class="token string">&quot;ZK_HEAD_PORTRAIT&quot;</span><span class="token punctuation">,</span>

    <span class="token string">&quot;ZK_USERSOURCE&quot;</span><span class="token punctuation">,</span>

    <span class="token string">&quot;EB_CREATE_DATETIME&quot;</span><span class="token punctuation">,</span>

    <span class="token string">&quot;EB_CREATEBY&quot;</span><span class="token punctuation">,</span>

    <span class="token string">&quot;EB_LASTMODIFYBY&quot;</span><span class="token punctuation">,</span>

    <span class="token string">&quot;EB_LASTMODIFY_DATETIME&quot;</span>

<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ZK_USERINFO</span> <span class="token punctuation">{</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        propertys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> name <span class="token keyword">in</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>propertys<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                    <span class="token keyword">this</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>

                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token constant">ZK_USERINFO</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="http://upload-images.jianshu.io/upload_images/13908708-329a39d606be8ef8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>ZK_USERINFO.js</p> <p>其中propertys为对应数据表的字段名、ZK_USERINFO为实体类名、constructor为构造函数，get/set分别为获取和设置属性的方法。</p> <p><strong>其他五个文件都是如此，这里不再展开。</strong></p> <p>PS：如果不熟悉什么是类和ES6，那就把这里的类比喻成js下的一个构造函数（实际也是如此）</p> <div class="language- extra-class"><pre class="language-text"><code>class ZK_USERINFO{   }  就是 function ZK_USERINFO{  }
</code></pre></div><p>为了<strong>方便导出数据</strong>，我们再在model下创建一个文件model.module.js，该文件用于把全部的实体类导出</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-5ba43ce6e53a77a0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>model.module.js导出全部的实体类</p> <h3 id="_8、开发底层模块"><a href="#_8、开发底层模块" class="header-anchor">#</a> 8、开发底层模块</h3> <p>在这里，我认为你具备面向对象的开发思路，并且对es6、sql有一定的了解。</p> <p><strong>第一步：连接数据库</strong></p> <p>数据就是基础，没有数据什么系统都跑不起来。我们这次采用的数据库是sql server（为了方便其他小伙伴，也会顺便说一下mysql的使用）</p> <p>nodejs连接sql server（也叫mssql）数据库，是用用上相应的模块的，这里用到的模块是mssql，官网地址是：<a href="https://www.npmjs.com/package/mssql" target="_blank" rel="noopener noreferrer">https://www.npmjs.com/package/mssql<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，github地址是：<a href="https://github.com/tediousjs/node-mssql" target="_blank" rel="noopener noreferrer">https://github.com/tediousjs/node-mssql<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，里面是全英介绍（其实也不是很难看懂）。</p> <p>node-base-demo项目中按照mssql模块（使用mysql的小伙伴请安装mysql模块）</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-3223cda39615e460.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>npm install mssql --save</p> <p>mssql模块安装成功了，不过还是那句话，记得加--save，这是个好习惯。</p> <p>那怎么才能连接上数据库呢？首先你得创建了数据库，然后配置好连接字符串，再然后connect上去，最后执行查询。</p> <p>从官方文档我们连接字符串有两种写法，第一种是对象写法，第二种是字符串写法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//第一种，对象形式</span>

<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>

user<span class="token operator">:</span><span class="token string">&quot;用户，一般是sa，超级管理员&quot;</span><span class="token punctuation">,</span>

password <span class="token operator">:</span><span class="token string">&quot;密码&quot;</span><span class="token punctuation">,</span>

server<span class="token operator">:</span><span class="token string">&quot;地址，一般是localhost、127.0.0.1或者远程服务器的ip&quot;</span><span class="token punctuation">,</span>

database<span class="token operator">:</span><span class="token string">&quot;数据库名，在我这里就是AuthPublish&quot;</span><span class="token punctuation">,</span>

options<span class="token operator">:</span><span class="token punctuation">{</span>

    encrypt<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">//如果你是window系统，就加上这个</span>

<span class="token punctuation">}</span>


<span class="token comment">//第二种：字符串形式</span>

mssql<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>username<span class="token operator">:</span>password@localhost<span class="token operator">/</span>database
</code></pre></div><p>我就特别喜欢第二种字符串形式了，因为简单多好。</p> <p>为了方便，我们<strong>新建一个web.config.js文件</strong>，该文件存放本项目的一些配置信息，如数据库的连接配置和其他参数。</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-6b3dd5aa506f1f45.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>web.config.js</p> <p>其中DbConnectionString为mssql的连接字符串，各位小伙伴使用的时候记得修改账号和密码。</p> <p>具体怎么连接呢？我们先看官方的文档</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-45c400581e22ec78.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>方式1：使用es7实现同步访问</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-5526d3e4c4cefef7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>方式2：使用es6的promise实现回调访问</p> <p><a href="https://github.com/tediousjs/node-mssql#promises" target="_blank" rel="noopener noreferrer">官方链接：https://github.com/tediousjs/node-mssql#promises<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>都说手摸手，那当然不能丢个官方文档出来了事，所以接着往下看。</p> <p><strong>第二步：封装DataAccess底层</strong></p> <p>面向对象编程的特点是什么？封装、继承和多态。我们总不能每写一个业务就敲一次数据库连接吧，这样工作量得多大啊，所以我们要把数据库访问封装起来。</p> <p>首先我们在根目录新建一个文件夹common，然后在common文件夹下新建一个DataAccess.js文件，该文件将封装我们的数据库访问。</p> <p>在DataAccess.js中，我们先把mssql模块和web.config.js配置文件引入，然后创建一个类叫DataAccess，并导出该类。DataAccess类中创建三个方法，第一个是constructor构造函数，第二个是GetTable获取数据表函数，第三个是RunQuery执行增删改函数，函数体先不写，此时代码如下</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-2b94d81f902c6aa2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>DataAccess.js</p> <p>紧接着我们在constructor构造函数中连接上sql server数据库（需要注意的是，这里的mssql模块只允许一个全局的连接，所以我们的连接上下文是放到全局环境上的），如下</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-1ad7dee98122be46.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>DataAccess 构造函数</p> <p>然后按照官方文档，使用Promise方式，查询和增删改封装如下：</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-f62773f95b6cb1de.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>GetTable 执行查询</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-78cedb321f062817.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>RunQuery 增删改（使用是事务）</p> <p>DataAccess.js完整代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> sql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mssql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> DbConnectionString <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../web.config'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">DataAccess</span> <span class="token punctuation">{</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>global<span class="token punctuation">[</span><span class="token string">&quot;globalConnection&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>config <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> sql<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

                global<span class="token punctuation">[</span><span class="token string">&quot;globalConnection&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> sql<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>config <span class="token operator">||</span> DbConnectionString<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span>connection <span class="token operator">=</span> global<span class="token punctuation">[</span><span class="token string">&quot;globalConnection&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">throw</span> err<span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token comment">/**

    * 执行查询

    * @param {*} sqlstring

    */</span>

    <span class="token function">GetTable</span><span class="token punctuation">(</span><span class="token parameter">sqlstring</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">pool</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

                <span class="token keyword">return</span> pool<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sqlstring<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

                <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>recordset<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

                <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            sql<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">/**

    * 执行增删改

    * @param {*} sqlstring

    */</span>

    <span class="token function">RunQuery</span><span class="token punctuation">(</span><span class="token parameter">sqlstring</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">pool</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

                <span class="token keyword">let</span> transaction <span class="token operator">=</span> pool<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                transaction<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

                    <span class="token keyword">let</span> request <span class="token operator">=</span> transaction<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    request<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sqlstring<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

                        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                            transaction<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

                            transaction<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                            <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>rowsAffected<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token punctuation">}</span>

                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            sql<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> DataAccess<span class="token punctuation">;</span>
</code></pre></div><p>这里使用mysql的小伙伴也别放弃，我的目标是DataAccess.js支持访问多种数据库，但是时间有限，只封装了一种，下面给出mysql的连接底层，感兴趣的可以整合到DataAccess中</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-2acdf6360ab979fa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>MysqlHelper.js</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-d43501daefe5e0b1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>web.config.js</p> <p>MysqlHelper.js的完整代码如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> MySqlConnectionCfg <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../web.config'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MySqlHelper</span> <span class="token punctuation">{</span>

    <span class="token comment">/**

    * 构造器

    */</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>connection <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>MySqlConnectionCfg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">/**

    * 执行查询

    * @param {*} sqlstring

    */</span>

    <span class="token function">GetTable</span><span class="token punctuation">(</span><span class="token parameter">sqlstring</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sqlstring<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                    <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

                    <span class="token keyword">let</span> _result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

                    result<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

                        <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> name <span class="token keyword">in</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                            obj<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>

                        <span class="token punctuation">}</span>

                        _result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token function">resolve</span><span class="token punctuation">(</span>_result<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">/**

    * 执行增删改

    * @param {*} sqlstring

    */</span>

    <span class="token function">ExecuteNonQuery</span><span class="token punctuation">(</span><span class="token parameter">sqlstring</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sqlstring<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                    <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>

                    <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MySqlHelper<span class="token punctuation">;</span>
</code></pre></div><p>可以看到mssql和mysql的封装还是很类似的。</p> <p>DataAccess底层封装了基础部分了，那么看一下如何使用</p> <p>首先需要把DataAccess导入，然后实例化DataAccess，最后调用具体方法并传入参数，我们在<strong>app.js</strong>下测试一下</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-2816ae09de8ed2c2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>测试DataAccess</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-602937d4b94e0f38.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>控制台输出正确结果，查询成功</p> <p>接着把测试代码修改一下，继续测试</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> DataAcess <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./common/DataAccess'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataAcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ds<span class="token punctuation">.</span><span class="token function">GetTable</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT NAME FROM SYSOBJECTS WHERE TYPE='U'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">dt</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dt<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="http://upload-images.jianshu.io/upload_images/13908708-f5d886ce9ff66ba4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>获取数据库全部表名（我的和你们的稍微不一样，我新建了其他的几个表）</p> <p>实验证明，DataAccess.js封装基本没问题，那么先继续往下走（记得把测试代码删掉哦）。</p> <p><strong>第三步：封装通用查询（核心）</strong></p> <p>又有小伙伴要发言了，不是说不用写sql语句吗，你怎么还写sql呢？（这位同学，请坐下，你影响后面陈独秀同学发言了）</p> <p>是这样的，一个复杂的业务不写sql还是有点困难的，但是。。。对于单表操作甚至是普通的多表操作，用我这个系统还真的可以不要写sql，那么我们接着往下。</p> <p>开发这么多个项目，查询功能比增删改多很多，而且复杂度也复杂好多，所以我计划封装一个通用查询，只需要传入查询枚举、查询条件、分页设置以及排序顺序，就可以帮你实现查询。</p> <p>好吧，这一块难到我了，倒不是如何实现难到我，而是我没办法一时解析清楚，因为这一部分设涉及的内容比较多，不过我相信我说的你能明白。</p> <p>由浅入深吧，我先把演示如何使用，使大家有一个宏观概念，再把用到的文件先事先说明，最后顺着前面的演示一步步去实现代码。</p> <div class="language- extra-class"><pre class="language-text"><code>问题_1：我们平常怎么去获取用户列表的呢？_

答：这不是很简单吗？一句sql语句不就搞定了？select *  from  ZK_USERINFO。

_问题2：那要获取没有被删除的用户呢（逻辑删除）？_

答：这不也很简单吗？也是一句sql的是。select  *  from  ZK_USERINFO  where  EB_ISDELETE = '0'。

_问题3：那我要分页获取没有被删除的用户呢？_

答：这不也很简单吗？就是sql长了一点而已，（噼里啪啦噼里啪啦）。
</code></pre></div><p>有没有发现这些sql代码拼的有点不舒服，改一个需求我还得去读懂sql再去修改，那有什么方便的方法吗？有，下面就是简便的方法（这段代码你们现在是运行不起来的）。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> condition <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//查询条件实体类数组</span>

<span class="token keyword">let</span> pagesize <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span> <span class="token comment">//页数</span>

<span class="token keyword">let</span> pageno <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//页码</span>

<span class="token keyword">let</span> sort <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SortParam</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//排序实体类</span>

client<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span>QueryModel<span class="token punctuation">.</span><span class="token constant">ZK_USERINFO</span><span class="token punctuation">,</span> condition<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> pagesize<span class="token punctuation">,</span> pageno<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> sort<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">m</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//分页查询结果</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">throw</span> err<span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="http://upload-images.jianshu.io/upload_images/13908708-eebbc49929d4533f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>分页查询用户列表</p> <p><strong>没有看到任何的sql代码吧，它的确是可以实现查询。</strong></p> <p>接着我们先把需要新建的文件及其功能列出来</p> <div class="language- extra-class"><pre class="language-text"><code>1、common/TableCfg.js （数据库表与主键配置）

2、common/QueryModel.js（通用查询枚举）

3、common/MType.js （sql数据类型枚举）

4、common/MLogic.js （sql判断逻辑枚举）

5、common/MOperator.js （sql匹配枚举）

6、common/Direction.js （sql排序枚举）

7、common/SortParam.js （自定义排序参数实体类）

8、commom/MemoryCondition.js （自定义查询条件实体类）

9、common/MemoryResult.js （自定义查询结果实体类）

10、common/ServiceClient.js （暴露出去的通用查询接口）

**11、common/Single.js （底层核心）**
</code></pre></div><p>在commo文件夹下依次创建上述文件</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-070ec188cadcb877.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>新建11个新文件</p> <p>上述的是11个文件，前9个都是简单的配置或者枚举，下面直接把代码放出来</p> <p>》common/TableCfg.js</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>

    <span class="token constant">ZK_PERMITINFO</span><span class="token operator">:</span> <span class="token punctuation">{</span>

        name<span class="token operator">:</span> <span class="token string">&quot;ZK_PERMITINFO&quot;</span><span class="token punctuation">,</span>

        pk<span class="token operator">:</span> <span class="token string">&quot;ZK_ID&quot;</span>

    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token constant">ZK_PERMITCONFIG</span><span class="token operator">:</span> <span class="token punctuation">{</span>

        name<span class="token operator">:</span> <span class="token string">&quot;ZK_PERMITCONFIG&quot;</span><span class="token punctuation">,</span>

        pk<span class="token operator">:</span> <span class="token string">&quot;ZK_ID&quot;</span>

    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token constant">ZK_USERINFO</span><span class="token operator">:</span> <span class="token punctuation">{</span>

        name<span class="token operator">:</span> <span class="token string">&quot;ZK_USERINFO&quot;</span><span class="token punctuation">,</span>

        pk<span class="token operator">:</span> <span class="token string">&quot;ZK_ID&quot;</span>

    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token constant">ZK_ROLEINFO</span><span class="token operator">:</span> <span class="token punctuation">{</span>

        name<span class="token operator">:</span> <span class="token string">&quot;ZK_ROLEINFO&quot;</span><span class="token punctuation">,</span>

        pk<span class="token operator">:</span> <span class="token string">&quot;ZK_ID&quot;</span>

    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token constant">ZK_PARAMINFO</span><span class="token operator">:</span> <span class="token punctuation">{</span>

        name<span class="token operator">:</span> <span class="token string">&quot;ZK_PARAMINFO&quot;</span><span class="token punctuation">,</span>

        pk<span class="token operator">:</span> <span class="token string">&quot;ZK_ID&quot;</span>

    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token constant">ZK_INVESTMENT</span><span class="token operator">:</span> <span class="token punctuation">{</span>

        name<span class="token operator">:</span> <span class="token string">&quot;ZK_INVESTMENT&quot;</span><span class="token punctuation">,</span>

        pk<span class="token operator">:</span> <span class="token string">&quot;ZK_ID&quot;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>TableCfg.js下每一个元素分别对应数据库的表（映射）</p> <p><img src="http://upload-images.jianshu.io/upload_images/13908708-3af3361290846d3c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>ZK_USERINFO实体类与ZK_USERINFO表的关系</p> <p>上面的图片展示的是nodejs下的ZK_USERINFO实体类对应数据库表ZK_USERINFO，该数据库表的主键是ZK_ID（如果是多主键，以英文逗号分隔）</p> <p><strong>当新增模块的时候，需要在这里更新数据库映射。</strong></p> <hr> <p>》common/QueryModel.js</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>

    <span class="token constant">ZK_USERINFO</span><span class="token operator">:</span> <span class="token string">&quot;ZK_USERINFO&quot;</span><span class="token punctuation">,</span>

    <span class="token constant">ZK_PERMITINFO</span><span class="token operator">:</span> <span class="token string">&quot;ZK_PERMITINFO&quot;</span><span class="token punctuation">,</span>

    <span class="token constant">ZK_PERMITCONFIG</span><span class="token operator">:</span> <span class="token string">&quot;ZK_PERMITCONFIG&quot;</span><span class="token punctuation">,</span>

    <span class="token constant">ZK_ROLEINFO</span><span class="token operator">:</span> <span class="token string">&quot;ZK_ROLEINFO&quot;</span><span class="token punctuation">,</span>

    <span class="token constant">ZK_PARAMINFO</span><span class="token operator">:</span> <span class="token string">&quot;ZK_PARAMINFO&quot;</span><span class="token punctuation">,</span>

    <span class="token constant">ZK_INVESTMEN</span><span class="token operator">:</span> <span class="token string">&quot;ZK_INVESTMEN&quot;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>js是弱类型语言，其实是不支持枚举的，然而枚举非常常用，所以这里用对象的形式来模拟枚举，通过QueryModel.ZK_USERINFO可以实现获取信息（下同）</p> <p>这里的枚举是自由配置的，<strong>并不一定需要与实体类对应</strong>，只是为了方便，因为该枚举只是在ServiceClient通用查询中做<strong>switch</strong>判断。</p> <hr> <p>》common/MType.js</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>

    Mstring<span class="token operator">:</span> <span class="token string">&quot;Mstring&quot;</span><span class="token punctuation">,</span>

    Mint<span class="token operator">:</span> <span class="token string">&quot;Mint&quot;</span><span class="token punctuation">,</span>

    Mdatetime<span class="token operator">:</span> <span class="token string">&quot;Mdatetime&quot;</span><span class="token punctuation">,</span>

    Mdouble<span class="token operator">:</span> <span class="token string">&quot;Mdouble&quot;</span><span class="token punctuation">,</span>

    Mnull<span class="token operator">:</span> <span class="token string">&quot;Mnull&quot;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>nodejs下基础变量类型有好几个（string、number、boolean、null、undefined），数据库的数据类型也有好多个（varchar、nvarchar、text、int、double、datetime等），总的来说就都有字符串、整型、浮点型、时间类型和空，因此这里把数据类型做成枚举，方便底层sql字符串拼接（是的，你不用写sql代码，由底层进行自动拼接）。</p> <hr> <p>》common/MLogic.js</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>

    And<span class="token operator">:</span> <span class="token string">&quot;And&quot;</span><span class="token punctuation">,</span>

    Or<span class="token operator">:</span> <span class="token string">&quot;Or&quot;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>sql中两个条件间的关系无非就是“<strong>与</strong>”和“<strong>非</strong>”，所以这里把条件逻辑封装成枚举。</p> <hr> <p>》common/MOperator.js</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>

    Like<span class="token operator">:</span> <span class="token string">&quot;Like&quot;</span><span class="token punctuation">,</span>

    NotLike<span class="token operator">:</span> <span class="token string">&quot;NotLike&quot;</span><span class="token punctuation">,</span>

    Equal<span class="token operator">:</span> <span class="token string">&quot;Equal&quot;</span><span class="token punctuation">,</span>

    NotEqual<span class="token operator">:</span> <span class="token string">&quot;NotEqual&quot;</span><span class="token punctuation">,</span>

    LargeEqualThan<span class="token operator">:</span> <span class="token string">&quot;LargeEqualThan&quot;</span><span class="token punctuation">,</span>

    LargeThan<span class="token operator">:</span> <span class="token string">&quot;LargeThan&quot;</span><span class="token punctuation">,</span>

    LessEqualThan<span class="token operator">:</span> <span class="token string">&quot;LessEqualThan&quot;</span><span class="token punctuation">,</span>

    LessThan<span class="token operator">:</span> <span class="token string">&quot;LessThan&quot;</span><span class="token punctuation">,</span>

    Between<span class="token operator">:</span> <span class="token string">&quot;Between&quot;</span><span class="token punctuation">,</span>

    In<span class="token operator">:</span> <span class="token string">&quot;In&quot;</span><span class="token punctuation">,</span>

    NotIn<span class="token operator">:</span> <span class="token string">&quot;NotIn&quot;</span><span class="token punctuation">,</span>

    IsNull<span class="token operator">:</span> <span class="token string">&quot;IsNull&quot;</span><span class="token punctuation">,</span>

    LikeIn<span class="token operator">:</span> <span class="token string">&quot;LikeIn&quot;</span><span class="token punctuation">,</span>

    NotLikeIn<span class="token operator">:</span> <span class="token string">&quot;NotLikeIn&quot;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>前面MLogic.js说了<strong>条件间</strong>的逻辑，那么sql<strong>条件中</strong>有哪些<strong>匹配逻辑</strong>呢？</p> <p>了解sql的小伙伴就可以拍着胸脯说出来了：</p> <div class="language- extra-class"><pre class="language-text"><code>模糊匹配：like

全等匹配： = 

大于：&gt;

小于：&lt;

介于：between

范围：in

等等....
</code></pre></div><p>其实还有挺多这样的匹配逻辑的，为了方便，我们也是封装一个<strong>匹配逻辑枚举</strong>。具体作用是在sql底层中拼接字符串。</p> <hr> <p>》common/Direction.js</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>

    <span class="token constant">ASC</span><span class="token operator">:</span> <span class="token string">&quot;ASC&quot;</span><span class="token punctuation">,</span>

    <span class="token constant">DESC</span><span class="token operator">:</span> <span class="token string">&quot;DESC&quot;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>当然这里也不能少<strong>排序枚举</strong>，在数据查询中经常需要根据某个字段进行正序或者倒序排序，所以我们也封装了一个sql排序枚举。ASC代表正序（从小大大）；DESC代表倒序（从大到小）</p> <hr> <p>篇幅有限，后续硬货详见下一篇文章</p> <p>传送门：<a href="https://www.jianshu.com/p/60d6dc2d901a" target="_blank" rel="noopener noreferrer">《手摸手，教你用nodejs搭建后台最小系统（大量图文）系列二》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">5/6/2020, 3:11:47 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/log/how-to-quick-in-cmd.html" class="prev">快速进入此目录的命令窗口</a></span> <span class="next"><a href="/log/how-to-use-nodejs-build-mini-project-2.html">手把手，教你用nodejs搭建后台最小系统（大量图文）系列二</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.3328e81d.js" defer></script><script src="/assets/js/2.c715c0f2.js" defer></script><script src="/assets/js/33.69099052.js" defer></script>
  </body>
</html>
